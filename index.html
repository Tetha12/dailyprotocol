<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FRIDAY OS v25.0</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%236366f1'/><stop offset='100%25' stop-color='%23818cf8'/></linearGradient></defs><rect width='32' height='32' rx='8' fill='url(%23g)'/><text x='16' y='23' font-family='Arial Black,sans-serif' font-size='20' font-weight='900' text-anchor='middle' fill='white'>F</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    window.firebaseModules = { initializeApp, getFirestore, doc, getDoc, setDoc, onSnapshot };
    window.dispatchEvent(new Event('firebaseReady'));
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    body {
      font-family: 'Space Grotesk', sans-serif;
      background: linear-gradient(135deg, #020617, #0f172a, #170f2e);
      background-size: 200% 200%;
      animation: gradientBG 15s ease infinite;
      color: #e2e8f0;
      overflow: hidden;
      font-size: 18px;
    }
    
    h1, h2, h3, h4 { font-family: 'Outfit', sans-serif; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(99,102,241,.3); border-radius: 10px; }
    
    .grid-bg {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image: linear-gradient(rgba(255,255,255,.015) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,.015) 1px, transparent 1px);
      background-size: 48px 48px;
    }
    
    /* GLASSMORPHISM CORE */
    .glass {
      background: rgba(15, 23, 42, 0.35);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25);
      border-radius: 24px;
    }
    
    .glass-btn { transition: all .3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .glass-btn:hover {
      border-color: rgba(99,102,241,.4);
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }
    
    /* Ambient Orbs */
    .orb-1 {
      position: fixed; width: 600px; height: 600px; border-radius: 50%;
      background: radial-gradient(circle, rgba(99,102,241,0.15) 0%, rgba(0,0,0,0) 70%);
      top: -150px; left: -150px; z-index: 0; pointer-events: none; filter: blur(50px);
    }
    .orb-2 {
      position: fixed; width: 500px; height: 500px; border-radius: 50%;
      background: radial-gradient(circle, rgba(236,72,153,0.1) 0%, rgba(0,0,0,0) 70%);
      bottom: -150px; right: -100px; z-index: 0; pointer-events: none; filter: blur(60px);
    }
    
    .btn {
      background: linear-gradient(135deg, rgba(99,102,241,0.8), rgba(129,140,248,0.8));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.15);
      color: #fff; font-weight: 700; border-radius: 16px; padding: 14px 28px; cursor: pointer;
      box-shadow: 0 8px 24px rgba(99,102,241,.2); font-family: 'Outfit', sans-serif;
      font-size: 16px; letter-spacing: .05em; text-transform: uppercase;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      transition: all .3s; width: 100%;
    }
    .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(99,102,241,.4); background: linear-gradient(135deg, rgba(99,102,241,1), rgba(129,140,248,1)); }
    .btn:disabled { opacity: .5; cursor: not-allowed; }
    .btn-sm { padding: 8px 16px; font-size: 13px; border-radius: 10px; width: auto; }
    .btn-danger { background: linear-gradient(135deg, rgba(239,68,68,0.8), rgba(248,113,113,0.8)); }
    
    .prog { height: 10px; background: rgba(255,255,255,.05); border-radius: 99px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
    .prog-fill { height: 100%; border-radius: 99px; transition: width 1.2s cubic-bezier(.34,1.56,.64,1); }
    
    .tab {
      display: flex; align-items: center; gap: 14px; padding: 12px 18px; border-radius: 15px;
      font-weight: 600; font-size: 16px; transition: all .2s; cursor: pointer; border: 1px solid transparent;
      color: #64748b; background: transparent; width: 100%; text-align: left; font-family: 'Space Grotesk', sans-serif;
    }
    .tab:hover { color: #fff; background: rgba(255,255,255,.05); }
    .tab.on { color: #fff; background: rgba(99,102,241,.15); border-color: rgba(99,102,241,.3); backdrop-filter: blur(10px); }
    
    .pcard {
      background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,.08); border-radius: 20px; padding: 24px;
      cursor: pointer; transition: all .3s;
    }
    .pcard:hover { border-color: rgba(99,102,241,.4); background: rgba(255, 255, 255, 0.05); transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,.4); }
    
    .overlay { position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); display: flex; align-items: center; justify-content: center; padding: 16px; }
    .modal {
      background: rgba(10, 15, 30, 0.7); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
      border: 1px solid rgba(255,255,255,.12); border-radius: 28px; width: 100%; max-width: 900px; max-height: 92vh;
      display: flex; flex-direction: column; box-shadow: 0 40px 80px rgba(0,0,0,.6);
    }
    .modal-lg { max-width: 1100px; }
    
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    .anim { animation: fadeUp .4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    .blink { animation: blink 1s step-end infinite; }
    @keyframes scan { 0% { top: 0; opacity: 1; } 100% { top: 100%; opacity: 0; } }
    .scanwrap { position: relative; overflow: hidden; }
    .scanwrap::after { content: ''; position: absolute; left: 0; right: 0; height: 1px; background: linear-gradient(90deg,transparent,rgba(99,102,241,.8),transparent); animation: scan 2.5s linear infinite; }
    @keyframes pulseRing { 0% { transform: scale(.95); opacity: .8; } 70% { transform: scale(1.15); opacity: 0; } 100% { transform: scale(1.15); opacity: 0; } }
    .pring { position: relative; }
    .pring::after { content: ''; position: absolute; inset: -6px; border-radius: 22px; border: 2px solid rgba(99,102,241,.5); animation: pulseRing 2s ease-out infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spin { animation: spin 1s linear infinite; display: inline-flex; }
    @keyframes syncPulse { 0%, 100% { opacity: .3; } 50% { opacity: 1; } }
    .sync { animation: syncPulse 2s ease-in-out infinite; }
    
    input.inp, select.inp, textarea.inp {
      width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px; padding: 14px 18px; color: #fff; font-size: 16px; outline: none; transition: all .2s; font-family: 'Space Grotesk', sans-serif;
    }
    input.inp:focus, select.inp:focus, textarea.inp:focus { border-color: rgba(99,102,241,.6); box-shadow: 0 0 0 3px rgba(99,102,241,.15); background: rgba(0,0,0,0.5); }
    input.inp::placeholder, textarea.inp::placeholder { color: rgba(255,255,255,.3); }
    textarea.inp { resize: vertical; min-height: 80px; }
    
    .sidebar {
      height: 100vh; background: rgba(10, 15, 30, 0.4); border-right: 1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); display: flex; flex-direction: column;
      transition: width .35s cubic-bezier(.4,0,.2,1); overflow: hidden; position: relative; z-index: 40; flex-shrink: 0;
    }
    
    .mobnav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(10, 15, 30, 0.6); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); border-top: 1px solid rgba(255,255,255,.08); display: flex; justify-content: space-around; align-items: center; padding: 10px 4px 22px; z-index: 50; }
    .mobbtn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 9px 11px; border-radius: 12px; font-size: 11px; font-weight: 700; letter-spacing: .06em; text-transform: uppercase; cursor: pointer; border: none; background: transparent; color: #64748b; transition: all .2s; font-family: 'Space Grotesk', sans-serif; }
    .mobbtn.on { color: #818cf8; }
    
    .vcard { background: rgba(0,0,0,.2); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; padding: 12px 14px; display: flex; align-items: center; gap: 12px; cursor: pointer; transition: all .2s; }
    .vcard:hover { border-color: rgba(99,102,241,.4); background: rgba(255,255,255,.03); }
    .vcard.done { border-color: rgba(16,185,129,.3); background: rgba(16,185,129,.05); }
    
    .tag { display: inline-flex; padding: 3px 9px; border-radius: 6px; font-size: 12px; font-weight: 700; letter-spacing: .05em; text-transform: uppercase; }
    .icon-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 6px; color: #94a3b8; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
    .icon-btn:hover { background: rgba(99,102,241,0.25); color: #c7d2fe; border-color: rgba(99,102,241,0.5); }
    .icon-btn.red:hover { background: rgba(239,68,68,0.25); color: #fecaca; border-color: rgba(239,68,68,0.5); }
    
    .day-btn { padding: 8px 14px; border-radius: 10px; border: 1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.05); color: #94a3b8; font-weight: 700; font-size: 13px; cursor: pointer; transition: all .2s; font-family: 'Space Grotesk', sans-serif; backdrop-filter: blur(4px); }
    .day-btn:hover { border-color: rgba(99,102,241,.5); color: #fff; background: rgba(255,255,255,.1); }
    .day-btn.active { background: rgba(99,102,241,.2); border-color: rgba(99,102,241,.5); color: #e0e7ff; box-shadow: 0 4px 12px rgba(99,102,241,.2); }
    
    .col-swatch { width: 32px; height: 32px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all .2s; flex-shrink: 0; }
    .col-swatch.selected { border-color: #fff; transform: scale(1.15); box-shadow: 0 0 10px rgba(255,255,255,.4); }
    
    .stab { padding: 10px 18px; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; border: 1px solid transparent; color: #94a3b8; background: transparent; transition: all .2s; font-family: 'Space Grotesk', sans-serif; }
    .stab.on { background: rgba(99,102,241,.2); border-color: rgba(99,102,241,.4); color: #fff; box-shadow: 0 4px 15px rgba(99,102,241,.15); }
    
    .section-label { font-size: 12px; font-weight: 700; letter-spacing: .12em; text-transform: uppercase; color: #64748b; padding: 8px 0 6px; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo, useRef, useCallback } = React;

const FB = {
  apiKey:"AIzaSyCTQX07mRXuA73tvSpc_Rf3HNh5MpguENE",
  authDomain:"databasedailycheck.firebaseapp.com",
  projectId:"databasedailycheck",
  storageBucket:"databasedailycheck.firebasestorage.app",
  messagingSenderId:"1014838261484",
  appId:"1:1014838261484:web:afbfd9cfafe498f68757c9"
};
let _db=null;
const getDB=()=>{if(_db)return _db;const{initializeApp,getFirestore}=window.firebaseModules;_db=getFirestore(initializeApp(FB));return _db;};

// ── ICONS ──
const ICONS={
  'cpu':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>,
  'log-in':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>,
  'loader-2':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
  'zap':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
  'activity':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
  'map':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>,
  'book-open':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
  'layout-grid':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
  'settings-2':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>,
  'chevrons-left':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="11 17 6 12 11 7"/><polyline points="18 17 13 12 18 7"/></svg>,
  'chevrons-right':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/></svg>,
  'log-out':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  'calendar':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
  'scale':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="3" x2="12" y2="21"/><path d="M3 6l9-3 9 3"/><path d="M3 18l9 3 9-3"/></svg>,
  'dumbbell':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6.5 6.5h11"/><path d="M6.5 17.5h11"/><path d="M3 9.5v5"/><path d="M21 9.5v5"/><rect x="1" y="8" width="4" height="8" rx="1"/><rect x="19" y="8" width="4" height="8" rx="1"/><rect x="5" y="10" width="3" height="4" rx="1"/><rect x="16" y="10" width="3" height="4" rx="1"/></svg>,
  'code-2':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>,
  'check':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
  'external-link':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
  'x':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
  'plus':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  'play':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
  'pencil':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
  'trash-2':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
  'chevron-up':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"/></svg>,
  'chevron-down':<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>,
};
const Icon=({name,size=20,className='',style={}})=>{
  const svg=ICONS[name];
  if(!svg)return<span style={{display:'inline-flex',width:size,height:size,flexShrink:0,...style}}/>;
  return React.cloneElement(svg,{width:size,height:size,style:{display:'inline-flex',flexShrink:0,...style},className});
};

const PBar=({current,total,color='linear-gradient(90deg,#6366f1,#818cf8)'})=>(
  <div className="prog"><div className="prog-fill" style={{width:`${Math.min(100,Math.max(0,(current/(total||1))*100))}%`,background:color}}/></div>
);

const Modal=({isOpen,onClose,title,children,large=false})=>{
  if(!isOpen)return null;
  return(
    <div className="overlay" onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className={`modal anim${large?' modal-lg':''}`}>
        <div style={{padding:'24px 28px',borderBottom:'1px solid rgba(255,255,255,.07)',display:'flex',justifyContent:'space-between',alignItems:'center',borderRadius:'24px 24px 0 0',background:'rgba(255,255,255,.03)',flexShrink:0}}>
          <h3 style={{fontSize:20,fontWeight:700,color:'#fff',fontFamily:'Outfit,sans-serif',display:'flex',alignItems:'center',gap:10}}>{title}</h3>
          <button onClick={onClose} style={{padding:8,borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.1)',cursor:'pointer',color:'#e2e8f0',display:'flex',transition:'all 0.2s'}} onMouseOver={e=>e.currentTarget.style.background='rgba(255,255,255,.15)'} onMouseOut={e=>e.currentTarget.style.background='rgba(255,255,255,.08)'}><Icon name="x" size={18}/></button>
        </div>
        <div style={{padding:'24px 28px',overflowY:'auto',flex:1}}>{children}</div>
      </div>
    </div>
  );
};

// ── AUTH ──
const AuthGate=({onLogin})=>{
  const[username,setUsername]=useState('');
  const[loading,setLoading]=useState(false);
  const[error,setError]=useState('');
  const[typed,setTyped]=useState('');
  const msg='FRIDAY OS v25.0 — 3-Month Challenge Protocol...';
  
  useEffect(()=>{let i=0;const t=setInterval(()=>{setTyped(msg.slice(0,++i));if(i>=msg.length)clearInterval(t);},40);return()=>clearInterval(t);},[]);
  const submit=async(e)=>{
    e.preventDefault();
    const clean=username.trim().toLowerCase().replace(/[^a-z0-9_]/g,'');
    if(!clean||clean.length<3)return setError('Min 3 karakter.');
    setLoading(true);setError('');
    try{
      if(!window.firebaseModules)await new Promise(r=>window.addEventListener('firebaseReady',r,{once:true}));
      const db=getDB();const{doc,getDoc,setDoc}=window.firebaseModules;
      const ref=doc(db,'friday_users',clean);const snap=await getDoc(ref);
      if(!snap.exists())await setDoc(ref,{username:clean,createdAt:new Date().toISOString()});
      onLogin(clean);
    }catch(err){setError('Gagal konek Firestore.');}
    finally{setLoading(false);}
  };
  return(
    <div style={{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',position:'relative',overflow:'hidden'}}>
      <div className="grid-bg"/>
      <div className="orb-1"/>
      <div className="orb-2"/>
      <div className="anim" style={{position:'relative',zIndex:10,width:'100%',maxWidth:420,padding:'0 20px'}}>
        <div className="mono" style={{color:'rgba(99,102,241,.8)',fontSize:13,marginBottom:12,letterSpacing:'.1em'}}>{typed}<span className="blink">▋</span></div>
        <div className="glass scanwrap" style={{padding:36}}>
          <div style={{textAlign:'center',marginBottom:28}}>
            <div className="pring" style={{display:'inline-flex',width:68,height:68,background:'linear-gradient(135deg,rgba(99,102,241,0.9),rgba(129,140,248,0.9))',borderRadius:20,alignItems:'center',justifyContent:'center',boxShadow:'0 0 30px rgba(99,102,241,.4)',marginBottom:16, border: '1px solid rgba(255,255,255,0.2)'}}>
              <Icon name="cpu" size={30} className="text-white"/>
            </div>
            <h1 style={{fontSize:40,fontWeight:900,color:'#fff',letterSpacing:'-.02em',marginBottom:4}}>FRIDAY <span style={{color:'#818cf8'}}>OS</span></h1>
            <p className="mono" style={{fontSize:12,color:'#94a3b8',letterSpacing:'.15em',textTransform:'uppercase'}}>v25.0 · Glassmorphism Edition</p>
          </div>
          <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:14}}>
            {error&&<div style={{background:'rgba(239,68,68,.15)',border:'1px solid rgba(239,68,68,.3)',borderRadius:12,padding:'12px 14px',color:'#fecaca',fontSize:15}}>{error}</div>}
            <div style={{position:'relative'}}>
              <span className="mono" style={{position:'absolute',left:16,top:'50%',transform:'translateY(-50%)',color:'#818cf8',fontSize:15,fontWeight:600,userSelect:'none',pointerEvents:'none'}}>&gt;_</span>
              <input type="text" value={username} onChange={e=>setUsername(e.target.value.replace(/[^a-zA-Z0-9_]/g,''))} className="inp mono" style={{paddingLeft:44, height: 54}} placeholder="ID_Boss" autoComplete="off" autoCapitalize="none" maxLength={30} required/>
            </div>
            <button type="submit" className="btn" disabled={loading||username.length<3} style={{height: 54}}>
              {loading?<><span className="spin"><Icon name="loader-2" size={16}/></span>Connecting...</>:<><Icon name="log-in" size={16}/>Masuk Sistem</>}
            </button>
          </form>
        </div>
      </div>
    </div>
  );
};

// ── SYNC ──
const safeObj=(v)=>(v&&typeof v==='object'&&!Array.isArray(v))?v:{};
const useSync=(key,def,uid)=>{
  const[val,setVal]=useState(def);
  const[isReady,setIsReady]=useState(false);
  const timer=useRef(null);
  const defRef=useRef(def);
  useEffect(()=>{
    if(!uid||!window.firebaseModules)return;
    const{doc,onSnapshot}=window.firebaseModules;
    const ref=doc(getDB(),'friday_users',uid,'data',key);
    const unsub=onSnapshot(ref,snap=>{
      setVal(snap.exists()&&snap.data().val!=null?snap.data().val:defRef.current);
      setIsReady(true);
    },(err)=>{console.error(key,err);setVal(defRef.current);setIsReady(true);});
    return()=>unsub();
  },[uid,key]);
  const save=useCallback((v)=>{
    if(timer.current)clearTimeout(timer.current);
    timer.current=setTimeout(async()=>{
      if(!uid||!window.firebaseModules)return;
      try{const{doc,setDoc}=window.firebaseModules;await setDoc(doc(getDB(),'friday_users',uid,'data',key),{val:v},{merge:true});}
      catch(e){console.warn('Sync fail:',e);}
    },800);
  },[uid,key]);
  const set=useCallback((updater)=>{
    setVal(prev=>{const sp=prev!=null?prev:defRef.current;const next=typeof updater==='function'?updater(sp):updater;save(next);return next;});
  },[save]);
  return[val,set,isReady];
};

// ═══════════════════════════════════════
// DEFAULT DATA
// ═══════════════════════════════════════
const DEFAULT_ROADMAP=[
  {id:'js',title:'JavaScript Advanced',week:'1–3',desc:'Fondasi JS: scope, closure, async, OOP, design pattern.',color1:'#f59e0b',color2:'#f97316',pl:'https://www.youtube.com/watch?v=RwT41El778A&list=PLFIM0718LjIUGpY8wmE41W7rTJo_3Y46-',
    videos:[{id:'js01',title:'#01 – Pengenalan JavaScript Advanced',url:'https://www.youtube.com/watch?v=RwT41El778A'},{id:'js02',title:'#02 – Execution Context & Call Stack',url:'https://www.youtube.com/watch?v=RwT41El778A&list=PLFIM0718LjIUGpY8wmE41W7rTJo_3Y46-&index=2'},{id:'js03',title:'#03 – Scope & Lexical Environment',url:'https://www.youtube.com/watch?v=RwT41El778A&list=PLFIM0718LjIUGpY8wmE41W7rTJo_3Y46-&index=3'}],
    casestudies:[{id:'jscs1',title:'Case Study 1 – Event Emitter dari scratch',desc:'Observer pattern: subscribe, emit, unsubscribe.'}]},
  {id:'tw',title:'Tailwind CSS Mastery',week:'4–5',desc:'Utility-first CSS untuk UI modern dan responsif.',color1:'#06b6d4',color2:'#3b82f6',pl:'https://www.youtube.com/watch?v=z3slaXqmkT0&list=PLFIM0718LjIUHFRMzPJ0wGjx9_NlC5d1h',
    videos:[{id:'tw01',title:'#01 – Pengenalan Tailwind CSS',url:'https://www.youtube.com/watch?v=z3slaXqmkT0'},{id:'tw02',title:'#02 – Instalasi & Konfigurasi',url:'https://www.youtube.com/watch?v=z3slaXqmkT0&list=PLFIM0718LjIUHFRMzPJ0wGjx9_NlC5d1h&index=2'}],
    casestudies:[{id:'twcs1',title:'Case Study 1 – Landing Page Produk',desc:'Responsive product landing page.'}]},
  {id:'rt',title:'React.js Ecosystem',week:'6–7',desc:'Dynamic SPA: hooks, context, routing, state management.',color1:'#8b5cf6',color2:'#6366f1',pl:'https://www.youtube.com/watch?v=kcnwI_5nKyA&list=PLFIM0718LjIUu3X2zYNqomEWs3sYd-fV1',
    videos:[{id:'rt01',title:'#01 – Pengenalan React.js',url:'https://www.youtube.com/watch?v=kcnwI_5nKyA'},{id:'rt02',title:'#02 – JSX & Component',url:'https://www.youtube.com/watch?v=kcnwI_5nKyA&list=PLFIM0718LjIUu3X2zYNqomEWs3sYd-fV1&index=2'}],
    casestudies:[{id:'rtcs1',title:'Case Study 1 – Todo App + Context',desc:'Full CRUD, filter, persistent.'}]},
  {id:'nd',title:'Node.js Backend',week:'8-12',desc:'REST API: Express, auth JWT, middleware, deploy.',color1:'#10b981',color2:'#059669',pl:'https://www.youtube.com/watch?v=sSLJx5t4OJ4&list=PLFIM0718LjIW-XBdVOerYgKegBtD6rSfD',
    videos:[{id:'nd01',title:'#01 – Pengenalan Node.js',url:'https://www.youtube.com/watch?v=sSLJx5t4OJ4'},{id:'nd02',title:'#02 – NPM & Package Management',url:'https://www.youtube.com/watch?v=sSLJx5t4OJ4&list=PLFIM0718LjIW-XBdVOerYgKegBtD6rSfD&index=2'}],
    casestudies:[{id:'ndcs1',title:'Case Study 1 – REST API Blog (CRUD + Auth)',desc:'Register, login, CRUD posts, JWT.'}]}
];

const SCAPULAR_EXERCISES=[
  {name:"Child's Pose",detail:'2 x Tahan 30-45 detik',target:'Thoracic Mobility',category:'scapular'},
  {name:"Scapular Y in Child's Pose",detail:'2 x 8-10 Reps',target:'Lower Trapezius',category:'scapular'},
  {name:'Serratus Punch (Berbaring)',detail:'3 x 12-15 Reps',target:'Serratus Anterior',category:'scapular'},
  {name:'Push Up Plus',detail:'3 x 10-12 Reps',target:'Serratus Anterior',category:'scapular'},
  {name:'Plank to Downward Dog',detail:'3 x 8-10 Reps',target:'Serratus & Core',category:'scapular'},
  {name:'Standing Serratus Punches (Band)',detail:'3 x 12-15 Reps',target:'Serratus Anterior',category:'scapular'},
  {name:'YTW Prone',detail:'2 x 8 Reps per huruf',target:'Lower & Mid Trap',category:'scapular'},
];

const DEFAULT_WORKOUT={
  'Senin':{type:'Push Day (Gym)',focus:'Dada, Bahu, Trisep',col:'#ef4444',exercises:[
    {name:'Incline Dumbbell Press',detail:'3 x 10-12',target:'Dada Atas',category:'primary'},
    {name:'Pec Fly Machine',detail:'2 x 15',target:'Dada',category:'primary'},
    {name:'Shoulder Press DB',detail:'3 x 10-12',target:'Bahu',category:'primary'},
    {name:'Tricep Pushdown',detail:'3 x 12',target:'Trisep',category:'primary'},
  ]},
  'Selasa':{type:'Core (Home)',focus:'Otot Inti & Stabilitas',col:'#10b981',exercises:[
    {name:'Dead Bug',detail:'3 x 10-12',target:'Deep Core',category:'primary'},
    {name:'Bird Dog',detail:'3 x 10',target:'Stabilitas',category:'primary'},
    {name:'Plank Siku',detail:'3 x 30-45 Detik',target:'Core Depan',category:'primary'},
    {name:'Side Plank',detail:'3 x 20-30 Detik',target:'Obliques',category:'primary'},
    {name:'Glute Bridge',detail:'3 x 12-15 Reps',target:'Gluteus',category:'primary'},
  ]},
  'Rabu':{type:'Leg Day (Gym)',focus:'Paha & Gluteus',col:'#8b5cf6',exercises:[
    {name:'Goblet Squat',detail:'3 x 10-12',target:'Paha',category:'primary'},
    {name:'Bulgarian Split Squat',detail:'3 x 8-10',target:'Kaki (Unilateral)',category:'primary'},
    {name:'Leg Curl Machine',detail:'3 x 12',target:'Paha Belakang',category:'primary'},
    {name:'Leg Extension',detail:'3 x 12',target:'Paha Depan',category:'primary'},
  ]},
  'Kamis':{type:'Core (Home)',focus:'Otot Inti & Stabilitas',col:'#10b981',exercises:[
    {name:'Dead Bug',detail:'3 x 10-12',target:'Deep Core',category:'primary'},
    {name:'Bird Dog',detail:'3 x 10',target:'Stabilitas',category:'primary'},
    {name:'Plank Siku',detail:'3 x 30-45 Detik',target:'Core Depan',category:'primary'},
    {name:'Side Plank',detail:'3 x 20-30 Detik',target:'Obliques',category:'primary'},
    {name:'Glute Bridge',detail:'3 x 12-15 Reps',target:'Gluteus',category:'primary'},
  ]},
  'Jumat':{type:'Pull Day (Gym)',focus:'Punggung & Bisep',col:'#6366f1',exercises:[
    {name:'Lat Pulldown',detail:'3 x 10-12',target:'Sayap (Lats)',category:'primary'},
    {name:'Seated Cable Row',detail:'3 x 10-12',target:'Punggung Tengah',category:'primary'},
    {name:'One Arm DB Row',detail:'3 x 10',target:'Punggung Samping',category:'primary'},
    {name:'Hammer Curl',detail:'3 x 12',target:'Bisep',category:'primary'},
  ]},
  'Sabtu':{type:'Core (Home)',focus:'Otot Inti & Abs',col:'#f59e0b',exercises:[
    {name:'Dead Bug',detail:'3 x 10-12',target:'Core Dalam',category:'primary'},
    {name:'Bird Dog',detail:'3 x 10',target:'Stabilitas',category:'primary'},
    {name:'Plank Siku',detail:'3 x 40-60 Detik',target:'Core Depan',category:'primary'},
    {name:'Side Plank',detail:'3 x 30 Detik',target:'Obliques',category:'primary'},
    {name:'Glute Bridge',detail:'3 x 15 Reps',target:'Gluteus',category:'primary'},
  ]},
  'Minggu':{type:'Rest Day',focus:'Pemulihan & Persiapan',col:'#64748b',exercises:[
    {name:'Full Sleep',detail:'9 jam',target:'Pemulihan',category:'primary'},
    {name:'Meal Prep',detail:'1–2 jam',target:'Persiapan makan',category:'primary'},
    {name:'Stretching ringan',detail:'15–20 menit',target:'Fleksibilitas',category:'primary'},
    {name:'Review progress',detail:'30 menit',target:'Mental reset',category:'primary'},
  ]}
};

const DAYS=['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'];
const COLOR_PRESETS=['#ef4444','#f97316','#f59e0b','#84cc16','#10b981','#06b6d4','#3b82f6','#6366f1','#8b5cf6','#ec4899','#64748b','#fff'];
const COLOR_PAIRS=[['#f59e0b','#f97316'],['#06b6d4','#3b82f6'],['#8b5cf6','#6366f1'],['#10b981','#059669'],['#ef4444','#f97316'],['#ec4899','#a855f7'],['#64748b','#475569']];

// ═══════════════════════════════════════
// MAIN APP
// ═══════════════════════════════════════
const App=()=>{
  const[uid,setUid]=useState(null);
  const logout=()=>setUid(null);
  const[tab,setTab]=useState('daily');
  const[mob,setMob]=useState(window.innerWidth<768);
  const[collapsed,setCollapsed]=useState(false);

  // Modal states
  const[bookLog,setBookLog]=useState(false);
  const[bookEdit,setBookEdit]=useState(null);
  const[roadPhaseId,setRoadPhaseId]=useState(null);
  const[calModal,setCalModal]=useState(false);
  const[nutModal,setNutModal]=useState(false);
  const[editRMItem,setEditRMItem]=useState(null);
  const[settingsOpen,setSettingsOpen]=useState(false);
  const[settingsTab,setSettingsTab]=useState('roadmap');

  // Firebase data
  const[roadmapData,setRoadmapData,rReady]=useSync('roadmap_data',DEFAULT_ROADMAP,uid);
  const[weight,setWeight,wReady]=useSync('weight',{start:76,current:76,target:65},uid);
  const[cals,setCals,cReady]=useSync('calories',[],uid);
  const[exDone,setExDone,eReady]=useSync('exercises',{},uid);
  const[rprog,setRprog,rpReady]=useSync('roadmap',{},uid);
  const[library,setLibrary,lReady]=useSync('library',[{id:1,title:'Atomic Habits',author:'James Clear',totalPages:320,currentPage:0,coverUrl:'https://m.media-amazon.com/images/I/81wgcld4wxL.jpg'}],uid);
  const[workoutData,setWorkoutData,woReady]=useSync('workout_schedule',DEFAULT_WORKOUT,uid);

  const safeRM=Array.isArray(roadmapData)?roadmapData:DEFAULT_ROADMAP;
  const safeCals=Array.isArray(cals)?cals:[];
  const safeLib=Array.isArray(library)?library:[];
  const safeExDone=safeObj(exDone);
  const safeRprog=safeObj(rprog);
  const safeWO=(workoutData&&typeof workoutData==='object'&&!Array.isArray(workoutData))?workoutData:DEFAULT_WORKOUT;

  const isReady=rReady&&wReady&&cReady&&eReady&&rpReady&&lReady&&woReady;

  // Timeline: Starts March 2nd (of the current year based on execution context), for 90 Days
  const today=new Date();
  
  // Set start to March 2nd. Month is 0-indexed in JS (2 = March).
  const start=new Date(today.getFullYear(), 2, 2); 
  start.setHours(0,0,0,0);
  
  const TOTAL_DAYS = 90;
  const end=new Date(start);
  end.setDate(start.getDate() + TOTAL_DAYS);
  
  const diffDays=Math.floor((today-start)/86400000);
  // Cap between day 0 and TOTAL_DAYS
  const dayNDisplay=Math.max(0,Math.min(TOTAL_DAYS, diffDays+1));
  const pct=Math.round((dayNDisplay/TOTAL_DAYS)*100);
  
  const dayNames=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
  const dayName=dayNames[today.getDay()];
  const dateKey=today.toISOString().split('T')[0];
  const fmtDate=today.toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'});
  const missionDayIndex=Math.max(0,Math.min(TOTAL_DAYS - 1, diffDays));

  const ws=safeWO[dayName]||{type:'Rest',focus:'-',col:'#64748b',exercises:[]};
  const exKey=(ex)=>`${dateKey}-${dayName}-${ex.name}`;
  const isExDone=(ex)=>!!safeExDone[exKey(ex)];
  const toggleEx=(ex)=>setExDone(p=>{const s=safeObj(p);return{...s,[exKey(ex)]:!s[exKey(ex)]};});
  const fitProg=()=>{const es=(ws?.exercises||[]).filter(e=>e.category==='primary');const scap=SCAPULAR_EXERCISES;const allEx=[...es,...scap];return{done:allEx.filter(e=>isExDone(e)).length,total:allEx.length,primaryDone:es.filter(e=>isExDone(e)).length,primaryTotal:es.length,scapDone:scap.filter(e=>isExDone(e)).length,scapTotal:scap.length};};
  const primaryExes=(ws?.exercises||[]).filter(e=>e.category==='primary');
  const secondaryExes=SCAPULAR_EXERCISES;

  const dailyMissionsMatrix=useMemo(()=>{
    const all=[];
    safeRM.forEach(ph=>{
      (ph.videos||[]).forEach(v=>all.push({...v,phase:ph.title,phaseId:ph.id,type:'video'}));
      (ph.casestudies||[]).forEach(cs=>all.push({...cs,phase:ph.title,phaseId:ph.id,type:'case'}));
    });
    const ms=[];let vi=0,ci=0;
    const vids=all.filter(v=>v.type==='video'),cases=all.filter(v=>v.type==='case');
    // Generating missions for TOTAL_DAYS
    for(let d=0;d<TOTAL_DAYS;d++){
      const dm=[];
      for(let i=0;i<2;i++) if(vi<vids.length) dm.push(vids[vi++]);
      if(d%5===4&&ci<cases.length) dm.push(cases[ci++]);
      ms.push(dm);
    }
    return ms;
  },[safeRM]);

  const todayMissions=dailyMissionsMatrix[missionDayIndex]||[];
  const allVideoIds=safeRM.flatMap(p=>[...(p.videos||[]).map(v=>v.id),...(p.casestudies||[]).map(cs=>cs.id)]);
  const totalDone=allVideoIds.filter(id=>safeRprog[id]).length;
  const toggleRprog=(id)=>setRprog(p=>{const s=safeObj(p);return{...s,[id]:!s[id]};});

  useEffect(()=>{const h=()=>setMob(window.innerWidth<768);window.addEventListener('resize',h);return()=>window.removeEventListener('resize',h);},[]);

  if(!uid)return<AuthGate onLogin={setUid}/>;
  if(!isReady)return(
    <div style={{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',flexDirection:'column',gap:16, position: 'relative'}}>
      <div className="grid-bg"/>
      <div className="orb-1"/>
      <div className="pring" style={{display:'inline-flex',width:68,height:68,background:'rgba(255,255,255,0.05)', backdropFilter:'blur(20px)', borderRadius:20,alignItems:'center',justifyContent:'center', border: '1px solid rgba(255,255,255,0.1)'}}>
        <Icon name="cpu" size={30} className="text-white spin"/>
      </div>
      <div className="mono" style={{color:'#818cf8',fontWeight:600, letterSpacing: '0.1em'}}>SINKRONISASI FRIDAY OS...</div>
    </div>
  );

  const fp=fitProg();
  const tabs=[
    {id:'daily',icon:'zap',label:'Daily'},
    {id:'fitness',icon:'activity',label:'Fitness'},
    {id:'roadmap',icon:'map',label:'Roadmap'},
    {id:'library',icon:'book-open',label:'Library'},
    {id:'dashboard',icon:'layout-grid',label:'Overview'},
  ];

  const R=({children,style={}})=><div style={{display:'flex',alignItems:'center',...style}}>{children}</div>;
  const C=({children,style={}})=><div style={{display:'flex',flexDirection:'column',...style}}>{children}</div>;

  const activePhase=safeRM.find(p=>p.id===roadPhaseId);

  const handleSaveRMItem=(e)=>{
    e.preventDefault();
    const fd=new FormData(e.target);
    const ni={id:editRMItem.item?.id||`item_${Date.now()}`,title:fd.get('title')};
    if(editRMItem.type==='video')ni.url=fd.get('url');
    if(editRMItem.type==='case')ni.desc=fd.get('desc');
    setRoadmapData(prev=>{
      const sp=Array.isArray(prev)?prev:DEFAULT_ROADMAP;
      return sp.map(ph=>{
        if(ph.id!==editRMItem.phaseId)return ph;
        const lk=editRMItem.type==='video'?'videos':'casestudies';
        const list=ph[lk]||[];
        const exists=list.find(x=>x.id===ni.id);
        return{...ph,[lk]:exists?list.map(x=>x.id===ni.id?ni:x):[...list,ni]};
      });
    });
    setEditRMItem(null);
  };
  const handleDeleteRMItem=()=>{
    if(!confirm("Hapus materi ini?"))return;
    setRoadmapData(prev=>{
      const sp=Array.isArray(prev)?prev:DEFAULT_ROADMAP;
      return sp.map(ph=>{
        if(ph.id!==editRMItem.phaseId)return ph;
        const lk=editRMItem.type==='video'?'videos':'casestudies';
        return{...ph,[lk]:(ph[lk]||[]).filter(x=>x.id!==editRMItem.item.id)};
      });
    });
    setEditRMItem(null);
  };

  return(
    <div style={{display:'flex',height:'100vh',overflow:'hidden',position:'relative'}}>
      <div className="grid-bg"/>
      <div className="orb-1"/>
      <div className="orb-2"/>

      {/* SIDEBAR */}
      {!mob&&(
        <div className="sidebar" style={{width:collapsed?82:290}}>
          <div style={{padding:collapsed?'18px 0':'24px 20px',borderBottom:'1px solid rgba(255,255,255,.08)',display:'flex',alignItems:'center',gap:12,justifyContent:collapsed?'center':'flex-start'}}>
            <div style={{width:42,height:42,background:'linear-gradient(135deg,rgba(99,102,241,0.9),rgba(129,140,248,0.9))',borderRadius:12,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0, border: '1px solid rgba(255,255,255,0.2)', boxShadow: '0 4px 15px rgba(99,102,241,0.3)'}}>
              <Icon name="cpu" size={20} className="text-white"/>
            </div>
            {!collapsed&&<div><div style={{fontSize:22,fontWeight:900,color:'#fff',fontFamily:'Outfit'}}>FRIDAY <span style={{color:'#818cf8'}}>OS</span></div><div className="mono" style={{fontSize:11,color:'#94a3b8'}}>v25.0 Glass</div></div>}
          </div>
          {!collapsed&&<div style={{margin:'16px',padding:'14px 16px',background:'rgba(255,255,255,0.03)',borderRadius:16,border:'1px solid rgba(255,255,255,.08)',display:'flex',alignItems:'center',gap:12, backdropFilter: 'blur(10px)'}}>
            <div style={{width:38,height:38,background:'linear-gradient(135deg,#6366f1,#8b5cf6)',borderRadius:10,display:'flex',alignItems:'center',justifyContent:'center',fontWeight:800,fontSize:16,color:'#fff',flexShrink:0, boxShadow: '0 4px 10px rgba(99,102,241,0.3)'}}>{uid.charAt(0).toUpperCase()}</div>
            <div style={{flex:1,minWidth:0}}>
              <div className="mono" style={{fontSize:14,color:'#e0e7ff',fontWeight:700,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>Boss {uid}</div>
              <div style={{fontSize:12,color:'#94a3b8', marginTop: 2}}>Day {dayNDisplay}/{TOTAL_DAYS} · {pct}%</div>
            </div>
            <div className="sync" style={{width:6,height:6,borderRadius:'50%',background:'#34d399',flexShrink:0, boxShadow: '0 0 8px #34d399'}}/>
          </div>}
          
          <div style={{flex:1,padding:'8px 12px',display:'flex',flexDirection:'column',gap:4}}>
            {tabs.map(t=>(
              <button key={t.id} onClick={()=>setTab(t.id)} className={`tab ${tab===t.id?'on':''}`} style={{justifyContent:collapsed?'center':'flex-start',padding:collapsed?'14px 0':'12px 16px'}}>
                <Icon name={t.icon} size={20} style={{color: tab===t.id ? '#fff' : '#94a3b8'}}/>{!collapsed&&<span>{t.label}</span>}
              </button>
            ))}
          </div>
          <div style={{padding:'12px',borderTop:'1px solid rgba(255,255,255,.08)'}}>
            <button onClick={()=>{setSettingsTab('roadmap');setSettingsOpen(true);}} className="tab" style={{justifyContent:collapsed?'center':'flex-start',marginBottom:4,padding:collapsed?'12px 0':'12px 16px',color:'#818cf8'}}>
              <Icon name="settings-2" size={20}/>{!collapsed&&<span>Manage</span>}
            </button>
            <button onClick={()=>setCollapsed(p=>!p)} className="tab" style={{justifyContent:collapsed?'center':'flex-start',marginBottom:4,padding:collapsed?'12px 0':'12px 16px'}}>
              <Icon name={collapsed?'chevrons-right':'chevrons-left'} size={20}/>{!collapsed&&<span>Collapse</span>}
            </button>
            <button onClick={logout} className="tab" style={{color:'#f87171',justifyContent:collapsed?'center':'flex-start',padding:collapsed?'12px 0':'12px 16px'}}>
              <Icon name="log-out" size={20}/>{!collapsed&&<span>Logout</span>}
            </button>
          </div>
        </div>
      )}

      {/* MAIN */}
      <main style={{flex:1,overflowY:'auto',position:'relative',zIndex:10,paddingBottom:mob?88:0}}>
        {/* Header */}
        <div style={{position:'sticky',top:0,zIndex:30,background:'rgba(10, 15, 30, 0.5)',backdropFilter:'blur(24px)',WebkitBackdropFilter: 'blur(24px)',borderBottom:'1px solid rgba(255,255,255,.08)',padding:'16px 28px',display:'flex',justifyContent:'space-between',alignItems:'center',gap:12,flexWrap:'wrap'}}>
          <div>
            <R style={{gap:12,marginBottom:4}}>
              <div style={{width:42,height:42,borderRadius:12,background:'linear-gradient(135deg,rgba(99,102,241,0.9),rgba(129,140,248,0.9))',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 0 20px rgba(99,102,241,.4)',flexShrink:0, border: '1px solid rgba(255,255,255,0.2)'}}>
                <span style={{fontFamily:'Outfit,sans-serif',fontWeight:900,fontSize:24,color:'#fff',lineHeight:1}}>F</span>
              </div>
              <span style={{fontSize:22,fontWeight:800,color:'#fff'}}>Command Center</span>
              <span className="mono" style={{fontSize:12,color:'#e0e7ff',background:'rgba(99,102,241,.2)',border:'1px solid rgba(99,102,241,.4)',borderRadius:6,padding:'3px 8px'}}>Boss {uid}</span>
            </R>
            <div style={{fontSize:13,color:'#94a3b8',display:'flex',gap:8}}><span>{fmtDate}</span><span style={{color:'#475569'}}>·</span><span style={{color:'#a5b4fc',fontWeight:700}}>Day {dayNDisplay}/{TOTAL_DAYS}</span></div>
          </div>
          <R style={{gap:8}}>
            {mob&&<button onClick={()=>{setSettingsTab('roadmap');setSettingsOpen(true);}} style={{padding:'10px 14px',background:'rgba(99,102,241,.15)',border:'1px solid rgba(99,102,241,.3)',borderRadius:12,color:'#e0e7ff',cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontSize:13,fontWeight:700,fontFamily:'Space Grotesk,sans-serif', backdropFilter:'blur(4px)'}}>
              <Icon name="settings-2" size={16}/>Manage
            </button>}
            {[{fn:()=>setCalModal(true),label:'PROGRESS',val:`${pct}%`,col:'#818cf8',icon:'calendar'},{fn:()=>setNutModal(true),label:'BERAT',val:`${weight.current}kg`,col:'#34d399',icon:'scale'}].map(h=>(
              <button key={h.label} onClick={h.fn} className="glass glass-btn" style={{padding:'10px 16px',display:'flex',alignItems:'center',gap:12}}>
                <div style={{textAlign:'left'}}><div style={{fontSize:11,color:h.col,fontWeight:700,letterSpacing:'.08em', marginBottom: 2}}>{h.label}</div><div style={{fontSize:22,fontWeight:800,color:'#fff', lineHeight: 1}}>{h.val}</div></div>
                <Icon name={h.icon} size={20} style={{color:h.col}}/>
              </button>
            ))}
            {mob&&<button onClick={logout} style={{padding:'10px 12px',background:'rgba(239,68,68,.15)',border:'1px solid rgba(239,68,68,.3)',borderRadius:12,color:'#fecaca',cursor:'pointer',display:'flex', backdropFilter:'blur(4px)'}}><Icon name="log-out" size={18}/></button>}
          </R>
        </div>

        <div style={{padding:'24px 28px',maxWidth:1150,margin:'0 auto'}}>

          {/* ═══ DAILY ═══ */}
          {tab==='daily'&&(
            <div className="anim" style={{display:'flex',flexDirection:'column',gap:16}}>
              <div style={{display:'grid',gridTemplateColumns:mob?'1fr':'1fr 1.6fr',gap:16}}>
                {/* Fitness card */}
                <div className="glass" style={{padding:28,display:'flex',flexDirection:'column',gap:18}}>
                  <R style={{justifyContent:'space-between'}}>
                    <div style={{padding:10,background:`${ws?.col}20`,borderRadius:12, border: `1px solid ${ws?.col}40`}}><Icon name="dumbbell" size={24} style={{color:ws?.col}}/></div>
                    <span style={{fontSize:13,fontWeight:700,color:ws?.col,background:`${ws?.col}15`,border:`1px solid ${ws?.col}30`,borderRadius:8,padding:'4px 10px'}}>{ws?.type}</span>
                  </R>
                  <div>
                    <h3 style={{fontSize:26,fontWeight:800,color:'#fff',marginBottom:4}}>Fitness Hari Ini</h3>
                    <p style={{fontSize:15,color:'#94a3b8'}}>{ws?.focus}</p>
                  </div>
                  <div style={{display:'flex',gap:10}}>
                    <span style={{fontSize:13,padding:'4px 10px',borderRadius:8,background:'rgba(99,102,241,.15)',color:'#a5b4fc',border:'1px solid rgba(99,102,241,.3)',fontWeight:700}}>⚡ Inti: {primaryExes.length}</span>
                    <span style={{fontSize:13,padding:'4px 10px',borderRadius:8,background:'rgba(16,185,129,.15)',color:'#6ee7b7',border:'1px solid rgba(16,185,129,.3)',fontWeight:700}}>🩻 Scapular: {secondaryExes.length}</span>
                  </div>
                  <div>
                    <R style={{justifyContent:'space-between',fontSize:15,color:'#94a3b8',marginBottom:8}}><span>Gerakan</span><span style={{color:'#fff',fontWeight:800}}>{fp.done}/{fp.total}</span></R>
                    <PBar current={fp.done} total={fp.total} color={`linear-gradient(90deg,${ws?.col},${ws?.col}aa)`}/>
                  </div>
                  <button onClick={()=>setTab('fitness')} className="btn" style={{background:`linear-gradient(135deg,${ws?.col}dd,${ws?.col})`,fontSize:14,padding:'14px 24px', marginTop: 8}}>
                    <Icon name="play" size={16}/> Mulai Workout
                  </button>
                </div>
                {/* Coding missions */}
                <div className="glass" style={{padding:28,display:'flex',flexDirection:'column',gap:16}}>
                  <R style={{gap:12,justifyContent:'space-between'}}>
                    <R style={{gap:12}}>
                      <div style={{padding:10,background:'rgba(99,102,241,.15)',borderRadius:12, border: '1px solid rgba(99,102,241,.3)'}}><Icon name="code-2" size={22} className="text-indigo-400"/></div>
                      <div>
                        <h3 style={{fontSize:20,fontWeight:800,color:'#fff'}}>Target Harian</h3>
                        <p style={{fontSize:14,color:'#94a3b8'}}>Day {dayNDisplay} — ceklis otomatis ke Roadmap</p>
                      </div>
                    </R>
                    <span className="mono" style={{fontSize:14,color:'#cbd5e1',background:'rgba(255,255,255,.05)',border:'1px solid rgba(255,255,255,.1)',borderRadius:8,padding:'4px 10px',fontWeight:700}}>{totalDone}/{allVideoIds.length}</span>
                  </R>
                  {todayMissions.length===0&&<div style={{textAlign:'center',padding:'24px 0',color:'#94a3b8',fontSize:15}}>🎉 Target hari ini selesai! Bosan? Lanjut ke Roadmap.</div>}
                  <C style={{gap:10}}>
                    {todayMissions.map(m=>{
                      const done=safeRprog[m.id];
                      return(
                        <div key={m.id} style={{background:done?'rgba(16,185,129,.05)':'rgba(0,0,0,.25)',border:`1px solid ${done?'rgba(16,185,129,.25)':'rgba(255,255,255,.08)'}`,borderRadius:14,padding:14,display:'flex',gap:12,alignItems:'flex-start', transition:'all 0.3s'}}>
                          <div style={{width:26,height:26,borderRadius:8,border:`2px solid ${done?'#10b981':'rgba(255,255,255,.2)'}`,background:done?'rgba(16,185,129,.2)':'rgba(255,255,255,.05)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,marginTop:2,cursor:'pointer', transition:'all 0.2s'}} onClick={()=>toggleRprog(m.id)}>
                            {done&&<Icon name="check" size={14} className="text-emerald-400"/>}
                          </div>
                          <div style={{flex:1}}>
                            <div style={{display:'flex',gap:6,marginBottom:4,flexWrap:'wrap'}}>
                              <span className="tag" style={{background:m.type==='video'?'rgba(99,102,241,.15)':'rgba(245,158,11,.15)',color:m.type==='video'?'#a5b4fc':'#fcd34d',border:`1px solid ${m.type==='video'?'rgba(99,102,241,.3)':'rgba(245,158,11,.3)'}`}}>{m.type==='video'?'▶ Video':'🔬 Case'}</span>
                              <span className="tag" style={{background:'rgba(255,255,255,.05)',color:'#cbd5e1',border:'1px solid rgba(255,255,255,.1)'}}>{m.phase}</span>
                            </div>
                            <p style={{fontSize:16,fontWeight:700,color:done?'#64748b':'#f8fafc',textDecoration:done?'line-through':'none',lineHeight:1.4}}>{m.title}</p>
                            {m.url&&<a href={m.url} target="_blank" rel="noopener" style={{fontSize:13,color:'#818cf8',marginTop:4,display:'inline-flex',alignItems:'center',gap:4,textDecoration:'none', fontWeight: 600}}><Icon name="external-link" size={12}/> Buka di YouTube</a>}
                          </div>
                        </div>
                      );
                    })}
                  </C>
                  <button onClick={()=>setTab('roadmap')} style={{padding:'12px',background:'rgba(255,255,255,0.03)',border:'1px dashed rgba(99,102,241,0.4)',borderRadius:12,color:'#a5b4fc',fontWeight:700,cursor:'pointer',fontSize:15,transition:'all 0.3s'}} onMouseOver={e=>e.currentTarget.style.background='rgba(99,102,241,0.1)'} onMouseOut={e=>e.currentTarget.style.background='rgba(255,255,255,0.03)'}>
                    Buka Roadmap Keseluruhan 🚀
                  </button>
                </div>
              </div>
              <div className="glass" style={{padding:24,display:'flex',alignItems:'center',gap:16,flexWrap:'wrap'}}>
                <div style={{padding:14,background:'rgba(245,158,11,.15)',borderRadius:14, border:'1px solid rgba(245,158,11,.3)'}}><Icon name="book-open" size={26} className="text-amber-400"/></div>
                <div style={{flex:1,minWidth:150}}><h3 style={{fontSize:22,fontWeight:800,color:'#fff',marginBottom:2}}>Daily Reading</h3><p style={{fontSize:14,color:'#94a3b8'}}>Target: <span style={{color:'#fcd34d',fontWeight:700}}>+15 halaman</span> per hari</p></div>
                <button onClick={()=>setBookLog(true)} style={{padding:'12px 20px',background:'linear-gradient(135deg,rgba(245,158,11,0.8),rgba(217,119,6,0.8))',border:'1px solid rgba(255,255,255,0.2)',borderRadius:14,color:'#fff',fontWeight:700,cursor:'pointer',display:'flex',alignItems:'center',gap:8,fontSize:14,fontFamily:'Space Grotesk,sans-serif', backdropFilter:'blur(4px)', transition:'all 0.2s'}} onMouseOver={e=>e.currentTarget.style.transform='translateY(-2px)'} onMouseOut={e=>e.currentTarget.style.transform='translateY(0)'}>
                  <Icon name="plus" size={16}/> Log Reading
                </button>
              </div>
            </div>
          )}

          {/* ═══ FITNESS ═══ */}
          {tab==='fitness'&&(
            <FitnessTab safeWO={safeWO} setWorkoutData={setWorkoutData} dayName={dayName} dateKey={dateKey} safeExDone={safeExDone} setExDone={setExDone} ws={ws} fp={fp} primaryExes={primaryExes} secondaryExes={secondaryExes} isExDone={isExDone} toggleEx={toggleEx} />
          )}

          {/* ═══ ROADMAP ═══ */}
          {tab==='roadmap'&&(
            <div className="anim">
              <R style={{gap:12,marginBottom:20,justifyContent:'space-between',flexWrap:'wrap'}}>
                <R style={{gap:12}}>
                  <div style={{padding:12,background:'rgba(99,102,241,.15)',borderRadius:14, border:'1px solid rgba(99,102,241,.3)'}}><Icon name="map" size={22} className="text-indigo-400"/></div>
                  <div>
                    <h2 style={{fontSize:26,fontWeight:800,color:'#fff'}}>Fullstack Curriculum</h2>
                    <p style={{fontSize:15,color:'#94a3b8'}}>Modul pembelajaran bebas disesuaikan (90 Hari)</p>
                  </div>
                </R>
                <button onClick={()=>{setSettingsTab('roadmap');setSettingsOpen(true);}} className="btn" style={{width:'auto',padding:'12px 20px',fontSize:14}}>
                  <Icon name="settings-2" size={16}/> Manage Roadmap
                </button>
              </R>
              <div style={{display:'grid',gridTemplateColumns:mob?'1fr':'repeat(2,1fr)',gap:16}}>
                {safeRM.map((p,idx)=>{
                  const videos=p.videos||[],casestudies=p.casestudies||[];
                  const allItems=[...videos.map(v=>v.id),...casestudies.map(cs=>cs.id)];
                  const done=allItems.filter(id=>safeRprog[id]).length;
                  const pp=Math.round((done/(allItems.length||1))*100);
                  const c1=p.color1||p.c?.[0]||'#6366f1', c2=p.color2||p.c?.[1]||'#818cf8';
                  return(
                    <div key={p.id} className="pcard glass-btn" onClick={()=>setRoadPhaseId(p.id)}>
                      <R style={{justifyContent:'space-between',marginBottom:14}}>
                        <R style={{gap:12}}>
                          <div style={{width:52,height:52,borderRadius:14,background:`linear-gradient(135deg,${c1},${c2})`,display:'flex',alignItems:'center',justifyContent:'center',fontWeight:900,color:'#fff',fontSize:24,boxShadow:`0 4px 20px ${c1}60`}}>{idx+1}</div>
                          <div>
                            <h3 style={{fontSize:18,fontWeight:800,color:'#fff'}}>{p.title}</h3>
                            <span style={{fontSize:13,color:'#94a3b8',fontWeight:700,textTransform:'uppercase',letterSpacing:'.05em'}}>Week {p.week} · {videos.length}v · {casestudies.length}cs</span>
                          </div>
                        </R>
                        <span style={{fontSize:28,fontWeight:900,color:'rgba(255,255,255,.15)'}}>{pp}%</span>
                      </R>
                      <PBar current={done} total={allItems.length} color={`linear-gradient(90deg,${c1},${c2})`}/>
                      <R style={{justifyContent:'space-between',marginTop:10}}>
                        <div style={{fontSize:14,color:'#cbd5e1', fontWeight: 600}}>{done}/{allItems.length} selesai</div>
                        <div style={{fontSize:13,color:'#94a3b8'}}>{(p.desc||'').slice(0,40)}…</div>
                      </R>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {/* ═══ LIBRARY ═══ */}
          {tab==='library'&&(
            <div className="anim">
              <R style={{justifyContent:'space-between',marginBottom:20}}>
                <h2 style={{fontSize:26,fontWeight:800,color:'#fff'}}>Your Library</h2>
                <button onClick={()=>setBookEdit({id:null,title:'',author:'',totalPages:0,currentPage:0,coverUrl:''})} className="btn" style={{width:'auto',padding:'12px 20px',fontSize:14}}><Icon name="plus" size={16}/> Add Book</button>
              </R>
              <div style={{display:'grid',gridTemplateColumns:mob?'1fr':'repeat(3,1fr)',gap:16}}>
                {safeLib.map(b=>(
                  <div key={b.id} className="glass glass-btn" style={{padding:20}} onClick={()=>setBookEdit(b)}>
                    <R style={{gap:14,marginBottom:14}}>
                      <div style={{width:60,height:85,background:'rgba(255,255,255,0.1)',borderRadius:8,overflow:'hidden',flexShrink:0,boxShadow:'0 10px 20px rgba(0,0,0,.5)', border: '1px solid rgba(255,255,255,0.1)'}}><img src={b.coverUrl} style={{width:'100%',height:'100%',objectFit:'cover'}} alt={b.title} onError={e=>{e.target.style.display='none'}}/></div>
                      <div style={{flex:1,minWidth:0}}><h3 style={{fontSize:18,fontWeight:800,color:'#fff',marginBottom:4,lineHeight:1.3}}>{b.title}</h3><p style={{fontSize:14,color:'#94a3b8'}}>{b.author}</p></div>
                    </R>
                    <div style={{fontSize:13,fontWeight:800,color:'#a5b4fc',marginBottom:6,textTransform:'uppercase',letterSpacing:'.06em'}}>{Math.round((b.currentPage/(b.totalPages||1))*100)}%</div>
                    <PBar current={b.currentPage} total={b.totalPages}/>
                    <div style={{fontSize:13,color:'#cbd5e1',marginTop:8, fontWeight: 600}}>Hal {b.currentPage}/{b.totalPages}</div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* ═══ DASHBOARD ═══ */}
          {tab==='dashboard'&&(
            <div className="anim">
              <h2 style={{fontSize:26,fontWeight:800,color:'#fff',marginBottom:20}}>Overview</h2>
              <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:16,marginBottom:16}}>
                {[{icon:'activity',col:'#ef4444',label:'FITNESS',val:`${fp.done}/${fp.total}`},{icon:'calendar',col:'#6366f1',label:'HARI',val:`${dayNDisplay}/${TOTAL_DAYS}`},{icon:'scale',col:'#10b981',label:'BERAT',val:`${weight.current}kg`,sub:`→ ${weight.target}kg`},{icon:'code-2',col:'#818cf8',label:'CODING',val:`${totalDone}/${allVideoIds.length}`,sub:`${Math.round((totalDone/(allVideoIds.length||1))*100)}%`}].map(s=>(
                  <div key={s.label} className="glass" style={{padding:24,display:'flex',flexDirection:'column',alignItems:'center',textAlign:'center'}}>
                    <div style={{padding:12,background:`${s.col}20`,borderRadius:'50%',marginBottom:12, border: `1px solid ${s.col}40`}}><Icon name={s.icon} size={28} style={{color:s.col}}/></div>
                    <div style={{fontSize:13,fontWeight:800,color:'#94a3b8',letterSpacing:'.1em',marginBottom:4}}>{s.label}</div>
                    <div style={{fontSize:36,fontWeight:900,color:'#fff'}}>{s.val}</div>
                    {s.sub&&<div style={{fontSize:14,color:'#cbd5e1',marginTop:4, fontWeight:600}}>{s.sub}</div>}
                  </div>
                ))}
              </div>
              <div className="glass" style={{padding:24}}>
                <R style={{justifyContent:'space-between',marginBottom:12}}>
                  <div><h3 style={{fontSize:18,fontWeight:800,color:'#fff',marginBottom:2}}>Body Weight Journey</h3><p style={{fontSize:14,color:'#94a3b8'}}>{weight.start}kg → {weight.target}kg</p></div>
                  <div style={{fontSize:16,color:'#34d399',fontWeight:800}}>-{(weight.start-weight.current).toFixed(1)}kg</div>
                </R>
                <PBar current={weight.start-weight.current} total={weight.start-weight.target} color="linear-gradient(90deg,#10b981,#059669)"/>
              </div>
            </div>
          )}
        </div>
      </main>

      {mob&&(
        <nav className="mobnav">
          {tabs.map(t=>(
            <button key={t.id} className={`mobbtn ${tab===t.id?'on':''}`} onClick={()=>setTab(t.id)}>
              <Icon name={t.icon} size={20} className={tab===t.id?'text-indigo-400':''}/><span>{t.label}</span>
            </button>
          ))}
        </nav>
      )}

      {/* Settings Modal */}
      <SettingsModal isOpen={settingsOpen} onClose={()=>setSettingsOpen(false)} activeTab={settingsTab} setActiveTab={setSettingsTab} roadmapData={safeRM} setRoadmapData={setRoadmapData} workoutData={safeWO} setWorkoutData={setWorkoutData}/>

      {/* Roadmap Phase Detail */}
      <Modal isOpen={!!activePhase} onClose={()=>setRoadPhaseId(null)} title={activePhase?.title||''}>
        {activePhase&&(()=>{
          const c1=activePhase.color1||activePhase.c?.[0]||'#6366f1';
          const c2=activePhase.color2||activePhase.c?.[1]||'#818cf8';
          const phVideos=activePhase.videos||[];
          const phCases=activePhase.casestudies||[];
          return(
            <C style={{gap:16}}>
              <a href={activePhase.pl} target="_blank" rel="noopener noreferrer" style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'16px 20px',background:`linear-gradient(135deg,${c1}cc,${c2}cc)`, backdropFilter:'blur(10px)', border: '1px solid rgba(255,255,255,0.2)', borderRadius:16,textDecoration:'none',color:'#fff',boxShadow:`0 10px 30px ${c1}40`, transition:'all 0.3s'}} onMouseOver={e=>e.currentTarget.style.transform='translateY(-2px)'} onMouseOut={e=>e.currentTarget.style.transform='translateY(0)'}>
                <div><div style={{fontSize:20,fontWeight:900,marginBottom:2}}>▶ Buka Playlist YouTube</div><div style={{fontSize:14,opacity:.9, fontWeight: 600}}>{phVideos.length} video · {phCases.length} case study</div></div>
                <Icon name="play" size={24}/>
              </a>
              <p style={{fontSize:15,color:'#cbd5e1', lineHeight: 1.5}}>{activePhase.desc}</p>
              <div>
                <div style={{fontSize:13,fontWeight:800,color:'#94a3b8',letterSpacing:'.1em',textTransform:'uppercase',marginBottom:8}}>📹 VIDEO ({phVideos.filter(v=>safeRprog[v.id]).length}/{phVideos.length})</div>
                <C style={{gap:6,maxHeight:300,overflowY:'auto', paddingRight:4}}>
                  {phVideos.map((v,i)=>{const done=safeRprog[v.id];return(
                    <div key={v.id} className={`vcard ${done?'done':''}`}>
                      <div onClick={e=>{e.stopPropagation();toggleRprog(v.id);}} style={{width:20,height:20,borderRadius:6,border:`2px solid ${done?'#10b981':'rgba(255,255,255,.2)'}`,background:done?'rgba(16,185,129,.2)':'rgba(255,255,255,.05)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,cursor:'pointer'}}>
                        {done&&<Icon name="check" size={12} className="text-emerald-400"/>}
                      </div>
                      <div style={{flex:1}} onClick={e=>{e.stopPropagation();toggleRprog(v.id);}}>
                        <p style={{fontSize:15,fontWeight:700,color:done?'#64748b':'#f8fafc',textDecoration:done?'line-through':'none'}}>{i+1}. {v.title}</p>
                      </div>
                      <a href={v.url} target="_blank" rel="noopener" className="icon-btn"><Icon name="play" size={14}/></a>
                      <button onClick={e=>{e.stopPropagation();setEditRMItem({phaseId:activePhase.id,type:'video',item:v});}} className="icon-btn"><Icon name="pencil" size={14}/></button>
                    </div>
                  );})}
                  <button onClick={()=>setEditRMItem({phaseId:activePhase.id,type:'video',item:{}})} style={{padding:'10px',background:'rgba(255,255,255,0.03)',border:'1px dashed rgba(255,255,255,0.2)',borderRadius:12,color:'#a5b4fc',fontSize:14,fontWeight:700,display:'flex',alignItems:'center',justifyContent:'center',gap:6,cursor:'pointer',marginTop:4}}>
                    <Icon name="plus" size={14}/> Tambah Video
                  </button>
                </C>
              </div>
              <div>
                <div style={{fontSize:13,fontWeight:800,color:'#fcd34d',letterSpacing:'.1em',textTransform:'uppercase',marginBottom:8}}>🔬 CASE STUDIES ({phCases.filter(cs=>safeRprog[cs.id]).length}/{phCases.length})</div>
                <C style={{gap:6}}>
                  {phCases.map(cs=>{const done=safeRprog[cs.id];return(
                    <div key={cs.id} style={{display:'flex',gap:12,alignItems:'flex-start',padding:'14px',background:done?'rgba(245,158,11,.05)':'rgba(0,0,0,.2)',border:`1px solid ${done?'rgba(245,158,11,.3)':'rgba(255,255,255,.08)'}`,borderRadius:12}}>
                      <div onClick={()=>toggleRprog(cs.id)} style={{width:20,height:20,borderRadius:6,border:`2px solid ${done?'#f59e0b':'rgba(255,255,255,.2)'}`,background:done?'rgba(245,158,11,.2)':'rgba(255,255,255,.05)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,marginTop:2,cursor:'pointer'}}>
                        {done&&<Icon name="check" size={12} className="text-amber-400"/>}
                      </div>
                      <div style={{flex:1,cursor:'pointer'}} onClick={()=>toggleRprog(cs.id)}>
                        <p style={{fontSize:15,fontWeight:800,color:done?'#64748b':'#fcd34d',textDecoration:done?'line-through':'none',marginBottom:2}}>{cs.title}</p>
                        <p style={{fontSize:14,color:'#94a3b8'}}>{cs.desc}</p>
                      </div>
                      <button onClick={e=>{e.stopPropagation();setEditRMItem({phaseId:activePhase.id,type:'case',item:cs});}} className="icon-btn"><Icon name="pencil" size={14}/></button>
                    </div>
                  );})}
                  <button onClick={()=>setEditRMItem({phaseId:activePhase.id,type:'case',item:{}})} style={{padding:'10px',background:'rgba(255,255,255,0.03)',border:'1px dashed rgba(255,255,255,0.2)',borderRadius:12,color:'#a5b4fc',fontSize:14,fontWeight:700,display:'flex',alignItems:'center',justifyContent:'center',gap:6,cursor:'pointer',marginTop:4}}>
                    <Icon name="plus" size={14}/> Tambah Case Study
                  </button>
                </C>
              </div>
            </C>
          );
        })()}
      </Modal>

      {/* Edit RM Inline */}
      <Modal isOpen={!!editRMItem} onClose={()=>setEditRMItem(null)} title={editRMItem?.item?.id?`Edit ${editRMItem.type==='video'?'Video':'Case Study'}`:`Tambah ${editRMItem?.type==='video'?'Video':'Case Study'}`}>
        {editRMItem&&(
          <form onSubmit={handleSaveRMItem} style={{display:'flex',flexDirection:'column',gap:16}}>
            <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Judul</label><input name="title" type="text" defaultValue={editRMItem.item?.title||''} className="inp" required placeholder="Judul materi..."/></div>
            {editRMItem.type==='video'&&<div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Link YouTube</label><input name="url" type="url" defaultValue={editRMItem.item?.url||''} className="inp" required placeholder="https://youtube.com/..."/></div>}
            {editRMItem.type==='case'&&<div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Deskripsi</label><input name="desc" type="text" defaultValue={editRMItem.item?.desc||''} className="inp" required placeholder="Instruksi case study..."/></div>}
            <R style={{gap:12,marginTop:8}}>
              {editRMItem.item?.id&&<button type="button" onClick={handleDeleteRMItem} className="btn btn-danger btn-sm" style={{flex:1, padding: '12px'}}><Icon name="trash-2" size={16}/> Hapus</button>}
              <button type="submit" className="btn btn-sm" style={{flex:2, padding: '12px'}}>Simpan</button>
            </R>
          </form>
        )}
      </Modal>

      {/* Book Log Modal */}
      <Modal isOpen={bookLog} onClose={()=>setBookLog(false)} title="Log Reading Session">
        <C style={{gap:10}}>
          {safeLib.map(b=>(
            <button key={b.id} onClick={()=>{setLibrary(p=>{const s=Array.isArray(p)?p:[];return s.map(bk=>bk.id===b.id?{...bk,currentPage:Math.min(bk.totalPages,bk.currentPage+15)}:bk);});setBookLog(false);}} className="glass-btn" style={{display:'flex',alignItems:'center',gap:14,padding:14,background:'rgba(255,255,255,0.03)',border:'1px solid rgba(255,255,255,.08)',borderRadius:14,textAlign:'left',width:'100%',fontFamily:'Space Grotesk,sans-serif'}}>
              <div style={{width:42,height:56,background:'#1e293b',borderRadius:6,overflow:'hidden',flexShrink:0}}><img src={b.coverUrl} style={{width:'100%',height:'100%',objectFit:'cover'}} alt={b.title}/></div>
              <div style={{flex:1}}><div style={{fontSize:16,fontWeight:800,color:'#fff',marginBottom:2}}>{b.title}</div><div style={{fontSize:13,color:'#94a3b8'}}>{b.currentPage}/{b.totalPages} hal</div></div>
              <div style={{padding: '8px', background: 'rgba(245,158,11,0.1)', borderRadius: '10px', border: '1px solid rgba(245,158,11,0.3)'}}><Icon name="plus" size={16} className="text-amber-400"/></div>
            </button>
          ))}
        </C>
      </Modal>

      {/* Book Edit Modal */}
      <Modal isOpen={!!bookEdit} onClose={()=>setBookEdit(null)} title={bookEdit?.id?'Edit Buku':'Tambah Buku'}>
        {bookEdit&&(
          <form onSubmit={e=>{e.preventDefault();const fd=new FormData(e.target);const nb={id:bookEdit.id||Date.now(),title:fd.get('title'),author:fd.get('author'),totalPages:parseInt(fd.get('tp')),currentPage:parseInt(fd.get('cp')),coverUrl:fd.get('cover')};setLibrary(p=>{const s=Array.isArray(p)?p:[];return bookEdit.id?s.map(b=>b.id===nb.id?nb:b):[...s,nb];});setBookEdit(null);}} style={{display:'flex',flexDirection:'column',gap:14}}>
            {[['title','Judul','text',bookEdit.title,true],['author','Penulis','text',bookEdit.author,true],['cover','Cover URL','url',bookEdit.coverUrl,false]].map(([n,l,t,d,r])=>(
              <div key={n}><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>{l}</label><input name={n} type={t} defaultValue={d} className="inp" required={r}/></div>
            ))}
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
              {[['tp','Total Halaman',bookEdit.totalPages],['cp','Halaman Sekarang',bookEdit.currentPage]].map(([n,l,d])=>(
                <div key={n}><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>{l}</label><input name={n} type="number" min="0" defaultValue={d} className="inp" required/></div>
              ))}
            </div>
            <R style={{gap:12,marginTop:8}}>
              {bookEdit.id&&<button type="button" onClick={()=>{setLibrary(p=>{const s=Array.isArray(p)?p:[];return s.filter(b=>b.id!==bookEdit.id);});setBookEdit(null);}} className="btn btn-danger btn-sm" style={{flex:1, padding:'12px'}}>Hapus</button>}
              <button type="submit" className="btn btn-sm" style={{flex:2, padding:'12px'}}>Simpan</button>
            </R>
          </form>
        )}
      </Modal>

      {/* Weight Modal */}
      <Modal isOpen={nutModal} onClose={()=>setNutModal(false)} title="Update Berat Badan">
        <div style={{background:'rgba(16,185,129,.1)',border:'1px solid rgba(16,185,129,.25)',borderRadius:16,padding:20}}>
          <div style={{fontSize:13,fontWeight:800,color:'#34d399',marginBottom:4,textTransform:'uppercase',letterSpacing:'.08em'}}>Berat Badan Anda</div>
          <R style={{alignItems:'baseline',gap:8,marginBottom:14}}><span style={{fontSize:42,fontWeight:900,color:'#fff'}}>{weight.current}</span><span style={{fontSize:16,color:'#cbd5e1', fontWeight: 600}}>kg · target {weight.target}kg</span></R>
          <PBar current={weight.start-weight.current} total={weight.start-weight.target} color="linear-gradient(90deg,#10b981,#059669)"/>
          <form onSubmit={e=>{e.preventDefault();setWeight(p=>({...p,current:parseFloat(e.target.w.value)}));setNutModal(false);}} style={{display:'flex',gap:10,marginTop:16}}>
            <input name="w" type="number" step="0.1" placeholder={weight.current} className="inp" style={{flex:1, background: 'rgba(0,0,0,0.4)'}} required/>
            <button style={{padding:'12px 20px',background:'linear-gradient(135deg,rgba(16,185,129,0.9),rgba(5,150,105,0.9))',border:'1px solid rgba(255,255,255,0.2)',borderRadius:12,color:'#fff',fontWeight:800,cursor:'pointer',fontSize:16,fontFamily:'Space Grotesk,sans-serif'}}>Update</button>
          </form>
        </div>
      </Modal>

      {/* Calendar Modal */}
      <Modal isOpen={calModal} onClose={()=>setCalModal(false)} title="Timeline — 90 Days Challenge">
        <div style={{marginBottom:16,padding:'14px 18px',background:'rgba(99,102,241,.1)',borderRadius:14,border:'1px solid rgba(99,102,241,.3)',fontSize:14,color:'#a5b4fc',display:'flex',gap:12,flexWrap:'wrap', fontWeight: 600}}>
          <span>📅 Mulai: <b style={{color:'#fff'}}>{start.toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'})}</b></span>
          <span style={{color:'#475569'}}>·</span>
          <span>🏁 Selesai: <b style={{color:'#fff'}}>{end.toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'})}</b></span>
          <span style={{color:'#475569'}}>·</span>
          <span>Saat ini: <b style={{color:'#fcd34d'}}>Day {dayNDisplay}</b></span>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(10,1fr)',gap:6}}>
          {Array.from({length: TOTAL_DAYS}).map((_,i)=>{
            const dayNum=i+1;
            const past=dayNum<dayNDisplay;
            const cur=dayNum===dayNDisplay;
            const future=dayNum>dayNDisplay;
            const d=new Date(start);d.setDate(start.getDate()+i);
            const label=`${d.getDate()}/${d.getMonth()+1}`;
            return(
              <div key={i} title={`Day ${dayNum} — ${d.toLocaleDateString('id-ID',{day:'numeric',month:'short'})}`} style={{aspectRatio:'1',borderRadius:8,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:12,fontWeight:800,background:cur?'rgba(99,102,241,0.9)':past?'rgba(99,102,241,.2)':'rgba(255,255,255,.05)',color:cur?'#fff':past?'#c7d2fe':'#64748b',border:cur?'1px solid #fff':'1px solid rgba(255,255,255,.1)',boxShadow:cur?'0 0 15px rgba(99,102,241,.6)':'none',cursor:'default',transition:'all .2s'}}>
                <span>{dayNum}</span>
              </div>
            );
          })}
        </div>
        <div style={{display:'flex',gap:16,marginTop:16,fontSize:13, fontWeight: 600}}>
          {[{col:'#818cf8',label:'Hari ini'},{col:'rgba(99,102,241,.2)',label:'Sudah lewat'},{col:'rgba(255,255,255,.05)',label:'Belum'}].map(l=>(
            <div key={l.label} style={{display:'flex',alignItems:'center',gap:6}}><div style={{width:12,height:12,borderRadius:4,background:l.col,border:'1px solid rgba(255,255,255,.2)'}}/><span style={{color:'#cbd5e1'}}>{l.label}</span></div>
          ))}
        </div>
      </Modal>
    </div>
  );
};


// ═══════════════════════════════════════════════════════════════
// FITNESS TAB
// ═══════════════════════════════════════════════════════════════
const FitnessTab=({safeWO,setWorkoutData,dayName,dateKey,safeExDone,setExDone,ws,fp,primaryExes,secondaryExes,isExDone,toggleEx})=>{
  const[view,setView]=useState('today');
  const[selectedDay,setSelectedDay]=useState(dayName);
  const[editEx,setEditEx]=useState(null);
  const[editDayMeta,setEditDayMeta]=useState(false);

  const R=({children,style={}})=><div style={{display:'flex',alignItems:'center',...style}}>{children}</div>;
  const C=({children,style={}})=><div style={{display:'flex',flexDirection:'column',...style}}>{children}</div>;

  const viewDay=view==='today'?dayName:selectedDay;
  const viewWS=safeWO[viewDay]||{type:'Rest',focus:'-',col:'#64748b',exercises:[]};
  const viewExes=viewWS.exercises||[];
  const viewPrimary=viewExes.filter(e=>e.category==='primary');
  const isToday=viewDay===dayName;

  const todayPrimaryDone=(ws?.exercises||[]).filter(e=>e.category==='primary'&&isExDone(e)).length;
  const todayScapDone=SCAPULAR_EXERCISES.filter(e=>isExDone(e)).length;
  const todayDone=todayPrimaryDone+todayScapDone;
  const todayTotal=(ws?.exercises||[]).filter(e=>e.category==='primary').length+SCAPULAR_EXERCISES.length;

  const exKeyFor=(day,ex)=>`${dateKey}-${day}-${ex.name}`;
  const isDoneFor=(day,ex)=>!!safeExDone[exKeyFor(day,ex)];
  const toggleFor=(day,ex)=>setExDone(p=>{const s=typeof p==='object'&&p!==null?p:{};const k=exKeyFor(day,ex);return{...s,[k]:!s[k]};});

  const saveEx=(data)=>{
    const targetDay=data.dayKey||viewDay;
    setWorkoutData(p=>{
      const s=typeof p==='object'&&!Array.isArray(p)?p:{};
      const day=s[targetDay]||{type:'',focus:'',col:'#6366f1',exercises:[]};
      const list=[...(day.exercises||[])].filter(e=>e.category==='primary');
      const ne={name:data.name,detail:data.detail,target:data.target,category:'primary'};
      if(data.isNew){list.push(ne);}
      else{list[data.index]=ne;}
      return{...s,[targetDay]:{...day,exercises:list}};
    });
    setEditEx(null);
  };

  const deleteEx=(day,idx)=>{
    if(!confirm('Hapus gerakan ini?'))return;
    setWorkoutData(p=>{
      const s=typeof p==='object'&&!Array.isArray(p)?p:{};
      const d=s[day]||{exercises:[]};
      const list=[...(d.exercises||[])].filter(e=>e.category==='primary');
      list.splice(idx,1);
      return{...s,[day]:{...d,exercises:list}};
    });
  };

  const moveEx=(day,from,to)=>{
    setWorkoutData(p=>{
      const s=typeof p==='object'&&!Array.isArray(p)?p:{};
      const d=s[day]||{exercises:[]};
      const primary=[...(d.exercises||[])].filter(e=>e.category==='primary');
      const[item]=primary.splice(from,1);primary.splice(to,0,item);
      return{...s,[day]:{...d,exercises:primary}};
    });
  };

  const saveDayMeta=(day,field,val)=>{
    setWorkoutData(p=>{
      const s=typeof p==='object'&&!Array.isArray(p)?p:{};
      const d=s[day]||{exercises:[]};
      return{...s,[day]:{...d,[field]:val}};
    });
  };

  const weekSummary=DAYS.map(d=>{
    const wd=safeWO[d]||{type:'-',col:'#64748b',exercises:[]};
    const pri=(wd.exercises||[]).filter(e=>e.category==='primary').length;
    return{day:d,type:wd.type,col:wd.col,focus:wd.focus,pri,scap:SCAPULAR_EXERCISES.length,total:pri+SCAPULAR_EXERCISES.length};
  });

  const CategoryDivider=({label,col,borderCol,locked=false})=>(
    <div style={{display:'flex',alignItems:'center',gap:10,margin:'20px 0 12px'}}>
      <div style={{height:1,flex:1,background:borderCol}}/>
      <span style={{fontSize:12,fontWeight:800,letterSpacing:'.12em',color:col,background:`${col}15`,border:`1px solid ${col}40`,borderRadius:8,padding:'6px 14px',display:'flex',alignItems:'center',gap:6, backdropFilter:'blur(4px)'}}>
        {label}{locked&&<span style={{fontSize:10,background:'rgba(255,255,255,.1)',borderRadius:4,padding:'2px 6px',color:'#cbd5e1',fontWeight:800,letterSpacing:'.08em'}}>FIXED</span>}
      </span>
      <div style={{height:1,flex:1,background:borderCol}}/>
    </div>
  );

  const PrimaryCard=({ex,i,day,editable=false})=>{
    const done=isDoneFor(day,ex);
    const dayPrimary=(safeWO[day]?.exercises||[]).filter(e=>e.category==='primary');
    const trueIdx=dayPrimary.indexOf(ex);
    return(
      <div style={{display:'flex',alignItems:'center',gap:12,padding:'14px 16px',borderRadius:16,background:done?'rgba(16,185,129,.1)':'rgba(0,0,0,.3)',border:`1px solid ${done?'rgba(16,185,129,.3)':'rgba(99,102,241,.2)'}`,borderLeft:`4px solid ${done?'#10b981':'#818cf8'}`,transition:'all .3s', backdropFilter:'blur(4px)'}}>
        <div onClick={()=>toggleFor(day,ex)} style={{width:40,height:40,borderRadius:10,border:`2px solid ${done?'#10b981':'rgba(99,102,241,.5)'}`,background:done?'rgba(16,185,129,.2)':'rgba(99,102,241,.1)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,cursor:'pointer',transition:'all .2s'}}>
          {done?<Icon name="check" size={16} className="text-emerald-400"/>:<span style={{fontSize:15,fontWeight:900,color:'#818cf8'}}>{i+1}</span>}
        </div>
        <div style={{flex:1,minWidth:0}}>
          <div style={{fontSize:16,fontWeight:800,color:done?'#64748b':'#f8fafc',textDecoration:done?'line-through':'none',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{ex.name}</div>
          <div style={{fontSize:13,color:'#94a3b8', marginTop: 2, fontWeight: 600}}>{ex.detail} · <span style={{color:'#a5b4fc'}}>{ex.target}</span></div>
        </div>
        {editable&&(
          <div style={{display:'flex',gap:4,flexShrink:0}}>
            {trueIdx>0&&<button onClick={()=>moveEx(day,trueIdx,trueIdx-1)} className="icon-btn"><Icon name="chevron-up" size={12}/></button>}
            {trueIdx<dayPrimary.length-1&&<button onClick={()=>moveEx(day,trueIdx,trueIdx+1)} className="icon-btn"><Icon name="chevron-down" size={12}/></button>}
            <button onClick={()=>setEditEx({isNew:false,dayKey:day,index:trueIdx,...ex,category:'primary'})} className="icon-btn"><Icon name="pencil" size={12}/></button>
            <button onClick={()=>deleteEx(day,trueIdx)} className="icon-btn red"><Icon name="trash-2" size={12}/></button>
          </div>
        )}
      </div>
    );
  };

  const ScapularCard=({ex,i,day})=>{
    const done=isDoneFor(day,ex);
    return(
      <div style={{display:'flex',alignItems:'center',gap:12,padding:'14px 16px',borderRadius:16,background:done?'rgba(16,185,129,.1)':'rgba(0,0,0,.2)',border:`1px solid ${done?'rgba(16,185,129,.3)':'rgba(16,185,129,.2)'}`,borderLeft:'4px solid #10b981',transition:'all .3s', backdropFilter:'blur(4px)'}}>
        <div onClick={()=>toggleFor(day,ex)} style={{width:40,height:40,borderRadius:10,border:`2px solid ${done?'#10b981':'rgba(16,185,129,.4)'}`,background:done?'rgba(16,185,129,.2)':'rgba(16,185,129,.1)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,cursor:'pointer',transition:'all .2s'}}>
          {done?<Icon name="check" size={16} className="text-emerald-400"/>:<span style={{fontSize:15,fontWeight:900,color:'#10b981'}}>{i+1}</span>}
        </div>
        <div style={{flex:1,minWidth:0}}>
          <div style={{fontSize:16,fontWeight:800,color:done?'#64748b':'#f8fafc',textDecoration:done?'line-through':'none',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{ex.name}</div>
          <div style={{fontSize:13,color:'#94a3b8', marginTop:2, fontWeight: 600}}>{ex.detail} · <span style={{color:'#6ee7b7'}}>{ex.target}</span></div>
        </div>
        <span style={{fontSize:11,color:'#34d399',background:'rgba(16,185,129,.1)',border:'1px solid rgba(16,185,129,.2)',borderRadius:6,padding:'4px 8px',fontWeight:800,letterSpacing:'.06em',flexShrink:0}}>CORE</span>
      </div>
    );
  };

  return(
    <div className="anim">
      <R style={{justifyContent:'space-between',marginBottom:20,flexWrap:'wrap',gap:12}}>
        <div>
          <h2 style={{fontSize:26,fontWeight:900,color:'#fff',marginBottom:4}}>Fitness Tracker</h2>
          <p style={{fontSize:14,color:'#94a3b8', fontWeight: 600}}>⚡ Latihan Inti (Bebas) · 🩻 Scapular Winging (Locked Daily)</p>
        </div>
        <div style={{display:'flex',gap:0,background:'rgba(255,255,255,.05)',borderRadius:14,border:'1px solid rgba(255,255,255,.1)',overflow:'hidden', backdropFilter:'blur(4px)'}}>
          {[{id:'today',label:'Hari Ini'},{id:'weekly',label:'Mingguan'}].map(v=>(
            <button key={v.id} onClick={()=>setView(v.id)} style={{padding:'10px 20px',border:'none',background:view===v.id?'rgba(99,102,241,.25)':'transparent',color:view===v.id?'#e0e7ff':'#94a3b8',fontWeight:800,fontSize:14,cursor:'pointer',fontFamily:'Space Grotesk,sans-serif',transition:'all .2s',borderRight:v.id==='today'?'1px solid rgba(255,255,255,.1)':'none'}}>
              {v.label}
            </button>
          ))}
        </div>
      </R>

      {/* TODAY VIEW */}
      {view==='today'&&(
        <C style={{gap:0,maxWidth:720,margin:'0 auto'}}>
          <div className="glass" style={{padding:24,marginBottom:20,display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:16}}>
            <div style={{flex:1}}>
              <R style={{gap:14,marginBottom:12}}>
                <div style={{width:48,height:48,borderRadius:12,background:`${ws?.col}20`,border:`1px solid ${ws?.col}40`,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
                  <Icon name="dumbbell" size={22} style={{color:ws?.col}}/>
                </div>
                <div>
                  <div style={{fontSize:20,fontWeight:900,color:'#fff'}}>{dayName} — {ws?.type||'Rest'}</div>
                  <div style={{fontSize:14,color:'#cbd5e1', fontWeight: 600}}>{ws?.focus||'—'}</div>
                </div>
              </R>
              <PBar current={todayDone} total={todayTotal} color={`linear-gradient(90deg,${ws?.col},${ws?.col}aa)`}/>
              <div style={{fontSize:13,color:'#94a3b8',marginTop:8,display:'flex',gap:16,flexWrap:'wrap', fontWeight: 700}}>
                <span>{todayDone}/{todayTotal} total</span>
                <span style={{color:'#a5b4fc'}}>⚡ Inti: {todayPrimaryDone}/{(ws?.exercises||[]).filter(e=>e.category==='primary').length}</span>
                <span style={{color:'#6ee7b7'}}>🩻 Scapular: {todayScapDone}/{SCAPULAR_EXERCISES.length}</span>
              </div>
            </div>
            <div style={{textAlign:'center',background:'rgba(0,0,0,.3)',border:'1px solid rgba(255,255,255,.1)',borderRadius:16,padding:'14px 24px',flexShrink:0}}>
              <div style={{fontSize:42,fontWeight:900,color:'#fff',lineHeight:1}}>{todayDone}<span style={{fontSize:18,color:'#64748b'}}>/{todayTotal}</span></div>
              <div style={{fontSize:12,color:'#94a3b8',marginTop:4,letterSpacing:'.1em', fontWeight: 800}}>SELESAI</div>
            </div>
          </div>

          <R style={{gap:10,marginBottom:8,flexWrap:'wrap'}}>
            <button onClick={()=>setEditEx({isNew:true,dayKey:dayName,name:'',detail:'',target:'',category:'primary'})} style={{padding:'10px 16px',background:'rgba(99,102,241,.15)',border:'1px solid rgba(99,102,241,.3)',borderRadius:12,color:'#a5b4fc',fontWeight:800,fontSize:13,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif', backdropFilter:'blur(4px)'}}>
              <Icon name="plus" size={14}/>⚡ Tambah Latihan Inti
            </button>
          </R>

          {(()=>{const pri=(ws?.exercises||[]).filter(e=>e.category==='primary');return pri.length>0&&(
            <>
              <CategoryDivider label="⚡ LATIHAN INTI" col="#818cf8" borderCol="rgba(99,102,241,.3)" locked={false}/>
              <C style={{gap:10}}>
                {pri.map((ex,i)=><PrimaryCard key={ex.name+i} ex={ex} i={i} day={dayName} editable={true}/>)}
              </C>
            </>
          );})()}

          <CategoryDivider label="🩻 SCAPULAR WINGING" col="#10b981" borderCol="rgba(16,185,129,.3)" locked={true}/>
          <div style={{padding:'12px 16px',background:'rgba(16,185,129,.05)',border:'1px solid rgba(16,185,129,.15)',borderRadius:12,marginBottom:12,fontSize:13,color:'#94a3b8', fontWeight: 600}}>
            Sesi terapi wajib setiap hari. Tidak dapat dihapus.
          </div>
          <C style={{gap:10}}>
            {SCAPULAR_EXERCISES.map((ex,i)=><ScapularCard key={ex.name} ex={ex} i={i} day={dayName}/>)}
          </C>
        </C>
      )}

      {/* WEEKLY VIEW */}
      {view==='weekly'&&(
        <C style={{gap:16}}>
          <div style={{display:'flex',gap:8,overflowX:'auto',paddingBottom:8}}>
            {weekSummary.map(ws2=>{
              const isActive=selectedDay===ws2.day;
              const isTd=ws2.day===dayName;
              return(
                <button key={ws2.day} onClick={()=>setSelectedDay(ws2.day)} className="glass-btn" style={{flexShrink:0,padding:'12px 16px',borderRadius:14,border:`1px solid ${isActive?ws2.col+'60':'rgba(255,255,255,.08)'}`,background:isActive?ws2.col+'20':'rgba(255,255,255,.05)',textAlign:'center',fontFamily:'Space Grotesk,sans-serif',minWidth:100, backdropFilter:'blur(4px)'}}>
                  <div style={{fontSize:14,fontWeight:800,color:isActive?ws2.col:'#cbd5e1',display:'flex',alignItems:'center',justifyContent:'center',gap:6}}>
                    {ws2.day}{isTd&&<span style={{width:6,height:6,borderRadius:'50%',background:'#34d399',display:'inline-block', boxShadow:'0 0 6px #34d399'}}/>}
                  </div>
                  <div style={{fontSize:11,color:'#94a3b8',marginTop:4,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap',maxWidth:80, fontWeight:600}}>{ws2.type||'—'}</div>
                  <div style={{fontSize:10,marginTop:4,display:'flex',gap:6,justifyContent:'center', fontWeight:800}}>
                    <span style={{color:'#a5b4fc'}}>⚡{ws2.pri}</span>
                    <span style={{color:'#6ee7b7'}}>🩻{ws2.scap}</span>
                  </div>
                </button>
              );
            })}
          </div>

          {(()=>{
            const d=selectedDay;
            const wd=safeWO[d]||{type:'',focus:'',col:'#6366f1',exercises:[]};
            const pri=(wd.exercises||[]).filter(e=>e.category==='primary');
            const isTodayDay=d===dayName;
            return(
              <C style={{gap:14}}>
                <div className="glass" style={{border:`1px solid ${wd.col}40`,padding:20,borderLeft:`6px solid ${wd.col}`}}>
                  <R style={{justifyContent:'space-between',marginBottom:12,flexWrap:'wrap',gap:10}}>
                    <div>
                      <R style={{gap:10,marginBottom:4}}>
                        <span style={{fontSize:20,fontWeight:900,color:'#fff'}}>{d}</span>
                        {isTodayDay&&<span style={{fontSize:12,padding:'3px 10px',background:'rgba(16,185,129,.15)',border:'1px solid rgba(16,185,129,.3)',borderRadius:8,color:'#6ee7b7',fontWeight:800}}>HARI INI</span>}
                        <span style={{fontSize:13,padding:'3px 10px',background:wd.col+'20',border:`1px solid ${wd.col}50`,borderRadius:8,color:wd.col,fontWeight:800}}>{wd.type||'—'}</span>
                      </R>
                      <div style={{fontSize:14,color:'#94a3b8', fontWeight: 600}}>{wd.focus||'Belum ada fokus'}</div>
                    </div>
                    <button onClick={()=>setEditDayMeta(editDayMeta===d?false:d)} style={{padding:'8px 14px',background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.15)',borderRadius:10,color:'#cbd5e1',fontSize:13,fontWeight:800,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif', transition:'all 0.2s'}} onMouseOver={e=>e.currentTarget.style.background='rgba(255,255,255,.15)'} onMouseOut={e=>e.currentTarget.style.background='rgba(255,255,255,.08)'}>
                      <Icon name="pencil" size={14}/>Edit Info
                    </button>
                  </R>
                  {editDayMeta===d&&(
                    <div style={{borderTop:'1px solid rgba(255,255,255,.1)',paddingTop:16,display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
                      <div>
                        <label style={{fontSize:11,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Tipe Sesi</label>
                        <input value={wd.type||''} onChange={e=>saveDayMeta(d,'type',e.target.value)} className="inp" style={{fontSize:14,padding:'10px 14px', background:'rgba(0,0,0,0.3)'}} placeholder="Push Day..."/>
                      </div>
                      <div>
                        <label style={{fontSize:11,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Fokus Otot</label>
                        <input value={wd.focus||''} onChange={e=>saveDayMeta(d,'focus',e.target.value)} className="inp" style={{fontSize:14,padding:'10px 14px', background:'rgba(0,0,0,0.3)'}} placeholder="Dada, Bahu..."/>
                      </div>
                      <div style={{gridColumn:'1/-1'}}>
                        <label style={{fontSize:11,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:8,textTransform:'uppercase'}}>Warna Identitas</label>
                        <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
                          {COLOR_PRESETS.map(c=>(
                            <div key={c} onClick={()=>saveDayMeta(d,'col',c)} style={{width:28,height:28,borderRadius:8,background:c,cursor:'pointer',border:`2px solid ${wd.col===c?'#fff':'transparent'}`,transition:'all .2s',transform:wd.col===c?'scale(1.2)':'scale(1)', boxShadow: wd.col===c ? `0 0 10px ${c}` : 'none'}}/>
                          ))}
                        </div>
                      </div>
                    </div>
                  )}
                  <R style={{gap:16,marginTop:14,flexWrap:'wrap', fontWeight: 600}}>
                    <span style={{fontSize:13,color:'#94a3b8'}}>Total: <b style={{color:'#fff'}}>{pri.length+SCAPULAR_EXERCISES.length}</b></span>
                    <span style={{fontSize:13,color:'#a5b4fc'}}>⚡ Inti: <b>{pri.length}</b></span>
                    <span style={{fontSize:13,color:'#6ee7b7'}}>🩻 Scapular: <b>{SCAPULAR_EXERCISES.length}</b></span>
                  </R>
                </div>

                <R style={{gap:10}}>
                  <button onClick={()=>setEditEx({isNew:true,dayKey:d,name:'',detail:'',target:'',category:'primary'})} style={{padding:'9px 16px',background:'rgba(99,102,241,.15)',border:'1px solid rgba(99,102,241,.3)',borderRadius:12,color:'#a5b4fc',fontWeight:800,fontSize:13,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif', backdropFilter:'blur(4px)'}}>
                    <Icon name="plus" size={14}/>⚡ Tambah Latihan Inti
                  </button>
                </R>

                {pri.length>0&&(
                  <>
                    <CategoryDivider label="⚡ LATIHAN INTI" col="#818cf8" borderCol="rgba(99,102,241,.3)" locked={false}/>
                    <C style={{gap:10}}>
                      {pri.map((ex,i)=><PrimaryCard key={ex.name+i} ex={ex} i={i} day={d} editable={true}/>)}
                    </C>
                  </>
                )}
                {pri.length===0&&<div style={{fontSize:14,color:'#94a3b8',padding:'10px 0', fontWeight: 600}}>Belum ada latihan inti untuk hari {d}.</div>}

                <CategoryDivider label="🩻 SCAPULAR WINGING" col="#10b981" borderCol="rgba(16,185,129,.3)" locked={true}/>
                <C style={{gap:10}}>
                  {SCAPULAR_EXERCISES.map((ex,i)=><ScapularCard key={ex.name} ex={ex} i={i} day={d}/>)}
                </C>
              </C>
            );
          })()}
        </C>
      )}

      {editEx&&(
        <Modal isOpen={!!editEx} onClose={()=>setEditEx(null)} title={`${editEx.isNew?'Tambah':'Edit'} Latihan Inti — ${editEx.dayKey}`}>
          <InlineExForm initial={editEx} onSave={saveEx} onCancel={()=>setEditEx(null)}/>
        </Modal>
      )}
    </div>
  );
};

const InlineExForm=({initial,onSave,onCancel})=>{
  const[name,setName]=useState(initial.name||'');
  const[detail,setDetail]=useState(initial.detail||'');
  const[target,setTarget]=useState(initial.target||'');
  const submit=(e)=>{e.preventDefault();onSave({...initial,name,detail,target,category:'primary'});};
  return(
    <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:16}}>
      <div>
        <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Nama Gerakan</label>
        <input value={name} onChange={e=>setName(e.target.value)} className="inp" required placeholder="Misal: Bench Press, Dead Bug..."/>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
        <div>
          <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Set & Rep</label>
          <input value={detail} onChange={e=>setDetail(e.target.value)} className="inp" required placeholder="3 x 10-12"/>
        </div>
        <div>
          <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Target Otot</label>
          <input value={target} onChange={e=>setTarget(e.target.value)} className="inp" required placeholder="Dada, Core..."/>
        </div>
      </div>
      <div style={{padding:'14px',background:'rgba(99,102,241,.1)',border:'1px solid rgba(99,102,241,.25)',borderRadius:12}}>
        <span style={{fontSize:13,color:'#a5b4fc',fontWeight:800}}>⚡ Kategori: Latihan Inti</span>
        <p style={{fontSize:12,color:'#cbd5e1',marginTop:4, fontWeight: 600}}>Latihan fleksibel. Scapular Winging otomatis fixed harian.</p>
      </div>
      <div style={{display:'flex',gap:12,marginTop:8}}>
        <button type="button" onClick={onCancel} style={{flex:1,padding:'12px',borderRadius:12,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.15)',color:'#cbd5e1',fontWeight:800,cursor:'pointer',fontSize:15,fontFamily:'Space Grotesk,sans-serif'}}>Batal</button>
        <button type="submit" className="btn btn-sm" style={{flex:2, padding: '12px', fontSize: 15}}>Simpan Gerakan</button>
      </div>
    </form>
  );
};

// ═══════════════════════════════════════════════════════════════
// SETTINGS MODAL
// ═══════════════════════════════════════════════════════════════
const SettingsModal=({isOpen,onClose,activeTab,setActiveTab,roadmapData,setRoadmapData,workoutData,setWorkoutData})=>{
  return(
    <Modal isOpen={isOpen} onClose={onClose} title="Sistem Manajerial" large>
      <div style={{display:'flex',flexDirection:'column',gap:0,minHeight:'60vh'}}>
        <div style={{display:'flex',gap:8,marginBottom:24,padding:'6px',background:'rgba(0,0,0,.3)',borderRadius:16,border:'1px solid rgba(255,255,255,.1)', backdropFilter:'blur(10px)'}}>
          {[{id:'roadmap',icon:'map',label:'Roadmap Editor'},{id:'workout',icon:'dumbbell',label:'Workout Schedule'}].map(t=>(
            <button key={t.id} className={`stab ${activeTab===t.id?'on':''}`} style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',gap:8, padding: '12px', borderRadius: '12px'}} onClick={()=>setActiveTab(t.id)}>
              <Icon name={t.icon} size={18}/>{t.label}
            </button>
          ))}
        </div>
        {activeTab==='roadmap'&&<RoadmapManager roadmapData={roadmapData} setRoadmapData={setRoadmapData}/>}
        {activeTab==='workout'&&<WorkoutManager workoutData={workoutData} setWorkoutData={setWorkoutData}/>}
      </div>
    </Modal>
  );
};

// ─────────────────────────────────────────
// ROADMAP MANAGER
// ─────────────────────────────────────────
const RoadmapManager=({roadmapData,setRoadmapData})=>{
  const[selectedPhase,setSelectedPhase]=useState(null);
  const[editPhase,setEditPhase]=useState(null);
  const[editItem,setEditItem]=useState(null);

  const safeRM=Array.isArray(roadmapData)?roadmapData:DEFAULT_ROADMAP;
  const phase=safeRM.find(p=>p.id===selectedPhase)||null;

  const savePhase=(data)=>{
    if(data.isNew){
      const np={id:`ph_${Date.now()}`,title:data.title,week:data.week,desc:data.desc,color1:data.color1,color2:data.color2,pl:data.pl,videos:[],casestudies:[]};
      setRoadmapData(prev=>{const s=Array.isArray(prev)?prev:DEFAULT_ROADMAP;return[...s,np];});
    }else{
      setRoadmapData(prev=>{const s=Array.isArray(prev)?prev:DEFAULT_ROADMAP;return s.map(p=>p.id===data.id?{...p,...data}:p);});
    }
    setEditPhase(null);
  };
  const deletePhase=(id)=>{
    if(!confirm("Hapus modul ini permanen?"))return;
    setRoadmapData(prev=>{const s=Array.isArray(prev)?prev:DEFAULT_ROADMAP;return s.filter(p=>p.id!==id);});
    if(selectedPhase===id)setSelectedPhase(null);
  };
  const saveItem=(data)=>{
    setRoadmapData(prev=>{
      const s=Array.isArray(prev)?prev:DEFAULT_ROADMAP;
      return s.map(p=>{
        if(p.id!==selectedPhase)return p;
        const lk=data.type==='video'?'videos':'casestudies';
        const list=p[lk]||[];
        const ni={id:data.id||`item_${Date.now()}`,title:data.title};
        if(data.type==='video')ni.url=data.url;
        if(data.type==='case')ni.desc=data.desc;
        const exists=list.find(x=>x.id===ni.id);
        return{...p,[lk]:exists?list.map(x=>x.id===ni.id?ni:x):[...list,ni]};
      });
    });
    setEditItem(null);
  };
  const deleteItem=(id,type)=>{
    setRoadmapData(prev=>{
      const s=Array.isArray(prev)?prev:DEFAULT_ROADMAP;
      return s.map(p=>{
        if(p.id!==selectedPhase)return p;
        const lk=type==='video'?'videos':'casestudies';
        return{...p,[lk]:(p[lk]||[]).filter(x=>x.id!==id)};
      });
    });
  };

  const R=({children,style={}})=><div style={{display:'flex',alignItems:'center',...style}}>{children}</div>;
  const C=({children,style={}})=><div style={{display:'flex',flexDirection:'column',...style}}>{children}</div>;

  return(
    <div style={{display:'grid',gridTemplateColumns:selectedPhase?'280px 1fr':'1fr',gap:20,minHeight:400}}>
      <C style={{gap:10}}>
        <R style={{justifyContent:'space-between',marginBottom:6}}>
          <span style={{fontSize:14,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',textTransform:'uppercase'}}>Modul</span>
          <button onClick={()=>setEditPhase({isNew:true,title:'',week:'',desc:'',color1:'#6366f1',color2:'#818cf8',pl:''})} style={{padding:'6px 12px',background:'rgba(99,102,241,.15)',border:'1px solid rgba(99,102,241,.3)',borderRadius:10,color:'#a5b4fc',fontWeight:800,fontSize:13,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif'}}>
            <Icon name="plus" size={14}/>Tambah
          </button>
        </R>
        {safeRM.map((p,idx)=>{
          const c1=p.color1||p.c?.[0]||'#6366f1';
          return(
            <div key={p.id} onClick={()=>setSelectedPhase(p.id)} className="glass-btn" style={{padding:'14px',borderRadius:14,border:`1px solid ${selectedPhase===p.id?'rgba(99,102,241,.5)':'rgba(255,255,255,.08)'}`,background:selectedPhase===p.id?'rgba(99,102,241,.15)':'rgba(0,0,0,.3)',display:'flex',alignItems:'center',gap:12, backdropFilter:'blur(4px)'}}>
              <div style={{width:38,height:38,borderRadius:10,background:`linear-gradient(135deg,${c1},${p.color2||p.c?.[1]||'#818cf8'})`,display:'flex',alignItems:'center',justifyContent:'center',fontWeight:900,color:'#fff',fontSize:15,flexShrink:0}}>{idx+1}</div>
              <div style={{flex:1,minWidth:0}}>
                <div style={{fontSize:15,fontWeight:800,color:'#f8fafc',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{p.title}</div>
                <div style={{fontSize:12,color:'#94a3b8', fontWeight: 600}}>Wk {p.week} · {(p.videos||[]).length}v {(p.casestudies||[]).length}cs</div>
              </div>
              <div style={{display:'flex',gap:6}}>
                <button onClick={e=>{e.stopPropagation();setEditPhase({...p});}} className="icon-btn"><Icon name="pencil" size={14}/></button>
              </div>
            </div>
          );
        })}
      </C>

      {selectedPhase&&phase&&(
        <div className="glass" style={{padding: 24}}>
          <C style={{gap:14}}>
            <R style={{justifyContent:'space-between',marginBottom:4}}>
              <div>
                <div style={{fontSize:22,fontWeight:900,color:'#fff'}}>{phase.title}</div>
                <div style={{fontSize:14,color:'#94a3b8', fontWeight: 600}}>Week {phase.week}</div>
              </div>
              <R style={{gap: 8}}>
                 <button onClick={()=>setEditPhase({...phase})} className="icon-btn" style={{padding: '8px 12px'}}><Icon name="pencil" size={16}/> Edit</button>
                 <button onClick={()=>deletePhase(phase.id)} className="icon-btn red" style={{padding: '8px 12px'}}><Icon name="trash-2" size={16}/></button>
                 <button onClick={()=>setSelectedPhase(null)} className="icon-btn"><Icon name="x" size={16}/></button>
              </R>
            </R>

            <div>
              <R style={{justifyContent:'space-between',marginBottom:8}}>
                <span className="section-label">📹 VIDEO ({(phase.videos||[]).length})</span>
                <button onClick={()=>setEditItem({type:'video',id:'',title:'',url:''})} style={{padding:'6px 12px',background:'rgba(99,102,241,.15)',border:'1px solid rgba(99,102,241,.3)',borderRadius:8,color:'#a5b4fc',fontSize:12,fontWeight:800,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif'}}><Icon name="plus" size={12}/>Tambah</button>
              </R>
              <C style={{gap:6,maxHeight:250,overflowY:'auto', paddingRight: 4}}>
                {(phase.videos||[]).map((v,i)=>(
                  <div key={v.id} style={{padding:'12px 14px',borderRadius:12,background:'rgba(0,0,0,.4)',border:'1px solid rgba(255,255,255,.08)',display:'flex',alignItems:'center',gap:12}}>
                    <span style={{fontSize:14,color:'#94a3b8',fontWeight:800,width:20,textAlign:'right',flexShrink:0}}>{i+1}</span>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontSize:14,fontWeight:700,color:'#f8fafc',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{v.title}</div>
                      {v.url&&<div style={{fontSize:12,color:'#64748b',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{v.url}</div>}
                    </div>
                    <button onClick={()=>setEditItem({type:'video',...v})} className="icon-btn"><Icon name="pencil" size={12}/></button>
                    <button onClick={()=>{if(confirm("Hapus video?"))deleteItem(v.id,'video');}} className="icon-btn red"><Icon name="trash-2" size={12}/></button>
                  </div>
                ))}
              </C>
            </div>

            <div>
              <R style={{justifyContent:'space-between',marginBottom:8, marginTop: 8}}>
                <span className="section-label">🔬 CASE STUDIES ({(phase.casestudies||[]).length})</span>
                <button onClick={()=>setEditItem({type:'case',id:'',title:'',desc:''})} style={{padding:'6px 12px',background:'rgba(245,158,11,.15)',border:'1px solid rgba(245,158,11,.3)',borderRadius:8,color:'#fcd34d',fontSize:12,fontWeight:800,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif'}}><Icon name="plus" size={12}/>Tambah</button>
              </R>
              <C style={{gap:6,maxHeight:200,overflowY:'auto', paddingRight: 4}}>
                {(phase.casestudies||[]).map((cs,i)=>(
                  <div key={cs.id} style={{padding:'12px 14px',borderRadius:12,background:'rgba(0,0,0,.4)',border:'1px solid rgba(255,255,255,.08)',display:'flex',alignItems:'center',gap:12}}>
                    <span style={{fontSize:14,color:'#94a3b8',fontWeight:800,width:20,textAlign:'right',flexShrink:0}}>{i+1}</span>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontSize:14,fontWeight:700,color:'#fcd34d',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{cs.title}</div>
                      <div style={{fontSize:12,color:'#64748b',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{cs.desc}</div>
                    </div>
                    <button onClick={()=>setEditItem({type:'case',...cs})} className="icon-btn"><Icon name="pencil" size={12}/></button>
                    <button onClick={()=>{if(confirm("Hapus case study?"))deleteItem(cs.id,'case');}} className="icon-btn red"><Icon name="trash-2" size={12}/></button>
                  </div>
                ))}
              </C>
            </div>
          </C>
        </div>
      )}

      {editPhase&&(
        <Modal isOpen={!!editPhase} onClose={()=>setEditPhase(null)} title={editPhase.isNew?'Tambah Modul Baru':'Edit Modul'}>
          <PhaseForm initial={editPhase} onSave={savePhase} onCancel={()=>setEditPhase(null)}/>
        </Modal>
      )}

      {editItem&&(
        <Modal isOpen={!!editItem} onClose={()=>setEditItem(null)} title={`${editItem.id?'Edit':'Tambah'} ${editItem.type==='video'?'Video':'Case Study'}`}>
          <ItemForm initial={editItem} onSave={saveItem} onCancel={()=>setEditItem(null)}/>
        </Modal>
      )}
    </div>
  );
};

const PhaseForm=({initial,onSave,onCancel})=>{
  const[title,setTitle]=useState(initial.title||'');
  const[week,setWeek]=useState(initial.week||'');
  const[desc,setDesc]=useState(initial.desc||'');
  const[color1,setColor1]=useState(initial.color1||'#6366f1');
  const[color2,setColor2]=useState(initial.color2||'#818cf8');
  const[pl,setPl]=useState(initial.pl||'');

  const submit=(e)=>{e.preventDefault();onSave({...initial,title,week,desc,color1,color2,pl});};

  return(
    <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:16}}>
      <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Nama Modul</label><input value={title} onChange={e=>setTitle(e.target.value)} className="inp" required placeholder="Misal: React.js Ecosystem" style={{background: 'rgba(0,0,0,0.4)'}}/></div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
        <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Week</label><input value={week} onChange={e=>setWeek(e.target.value)} className="inp" placeholder="Misal: 1–2" style={{background: 'rgba(0,0,0,0.4)'}}/></div>
        <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Playlist URL</label><input value={pl} onChange={e=>setPl(e.target.value)} className="inp" placeholder="https://youtube.com/..." style={{background: 'rgba(0,0,0,0.4)'}}/></div>
      </div>
      <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Deskripsi</label><textarea value={desc} onChange={e=>setDesc(e.target.value)} className="inp" placeholder="Deskripsi singkat..." style={{background: 'rgba(0,0,0,0.4)'}}/></div>
      <div>
        <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:10,textTransform:'uppercase'}}>Tema Warna</label>
        <div style={{display:'flex',gap:8,flexWrap:'wrap',marginBottom:12}}>
          {COLOR_PAIRS.map(([c1,c2])=>(
            <div key={c1} onClick={()=>{setColor1(c1);setColor2(c2);}} className={`col-swatch ${color1===c1?'selected':''}`} style={{background:`linear-gradient(135deg,${c1},${c2})`, width: 36, height: 36}}/>
          ))}
        </div>
        <div style={{height:48,borderRadius:12,background:`linear-gradient(135deg,${color1},${color2})`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:15,fontWeight:900,color:'#fff',letterSpacing:'.1em', boxShadow: `0 8px 20px ${color1}50`}}>PREVIEW</div>
      </div>
      <div style={{display:'flex',gap:12,marginTop:8}}>
        <button type="button" onClick={onCancel} style={{flex:1,padding:'12px',borderRadius:12,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.15)',color:'#cbd5e1',fontWeight:800,cursor:'pointer',fontSize:15,fontFamily:'Space Grotesk,sans-serif'}}>Batal</button>
        <button type="submit" className="btn btn-sm" style={{flex:2, padding: '12px', fontSize: 15}}>Simpan Modul</button>
      </div>
    </form>
  );
};

const ItemForm=({initial,onSave,onCancel})=>{
  const[title,setTitle]=useState(initial.title||'');
  const[url,setUrl]=useState(initial.url||'');
  const[desc,setDesc]=useState(initial.desc||'');
  const submit=(e)=>{e.preventDefault();onSave({...initial,title,url,desc});};
  return(
    <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:16}}>
      <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Judul</label><input value={title} onChange={e=>setTitle(e.target.value)} className="inp" required placeholder="Judul materi..." style={{background: 'rgba(0,0,0,0.4)'}}/></div>
      {initial.type==='video'&&<div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Link YouTube</label><input value={url} onChange={e=>setUrl(e.target.value)} className="inp" required placeholder="https://youtube.com/..." style={{background: 'rgba(0,0,0,0.4)'}}/></div>}
      {initial.type==='case'&&<div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Deskripsi</label><textarea value={desc} onChange={e=>setDesc(e.target.value)} className="inp" required placeholder="Instruksi / tugas case study..." style={{background: 'rgba(0,0,0,0.4)'}}/></div>}
      <div style={{display:'flex',gap:12,marginTop:8}}>
        <button type="button" onClick={onCancel} style={{flex:1,padding:'12px',borderRadius:12,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.15)',color:'#cbd5e1',fontWeight:800,cursor:'pointer',fontSize:15,fontFamily:'Space Grotesk,sans-serif'}}>Batal</button>
        <button type="submit" className="btn btn-sm" style={{flex:2, padding: '12px', fontSize: 15}}>Simpan</button>
      </div>
    </form>
  );
};

// ─────────────────────────────────────────
// WORKOUT MANAGER
// ─────────────────────────────────────────
const WorkoutManager=({workoutData,setWorkoutData})=>{
  const[activeDay,setActiveDay]=useState('Senin');
  const[editExercise,setEditExercise]=useState(null);
  const safeWO=(workoutData&&typeof workoutData==='object'&&!Array.isArray(workoutData))?workoutData:DEFAULT_WORKOUT;
  const dayData=safeWO[activeDay]||{type:'',focus:'',col:'#6366f1',exercises:[]};

  const R=({children,style={}})=><div style={{display:'flex',alignItems:'center',...style}}>{children}</div>;
  const C=({children,style={}})=><div style={{display:'flex',flexDirection:'column',...style}}>{children}</div>;

  const saveDayMeta=(field,val)=>{setWorkoutData(p=>{const s=typeof p==='object'&&!Array.isArray(p)?p:DEFAULT_WORKOUT;return{...s,[activeDay]:{...dayData,[field]:val}};});};
  const saveExercise=(ex)=>{
    setWorkoutData(p=>{
      const s=typeof p==='object'&&!Array.isArray(p)?p:DEFAULT_WORKOUT;
      const day=s[activeDay]||{exercises:[]};
      const list=day.exercises||[];
      if(ex.isNew){
        const ne={name:ex.name,detail:ex.detail,target:ex.target,category:ex.category||'primary'};
        return{...s,[activeDay]:{...day,exercises:[...list,ne]}};
      }else{
        return{...s,[activeDay]:{...day,exercises:list.map((e,i)=>i===ex.index?{name:ex.name,detail:ex.detail,target:ex.target,category:ex.category}:e)}};
      }
    });
    setEditExercise(null);
  };
  const deleteExercise=(idx)=>{
    if(!confirm("Hapus gerakan ini?"))return;
    setWorkoutData(p=>{const s=typeof p==='object'&&!Array.isArray(p)?p:DEFAULT_WORKOUT;const day=s[activeDay]||{exercises:[]};const list=[...(day.exercises||[])];list.splice(idx,1);return{...s,[activeDay]:{...day,exercises:list}};});
  };
  const moveExercise=(from,to)=>{
    setWorkoutData(p=>{const s=typeof p==='object'&&!Array.isArray(p)?p:DEFAULT_WORKOUT;const day=s[activeDay]||{exercises:[]};const list=[...(day.exercises||[])];const[item]=list.splice(from,1);list.splice(to,0,item);return{...s,[activeDay]:{...day,exercises:list}};});
  };

  const exercises=dayData.exercises||[];
  const primaryExes=exercises.filter(e=>e.category==='primary');

  return(
    <C style={{gap:16}}>
      <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
        {DAYS.map(d=>(
          <button key={d} className={`day-btn ${activeDay===d?'active':''}`} onClick={()=>setActiveDay(d)} style={{padding: '10px 16px', fontSize: 14}}>{d}</button>
        ))}
      </div>

      <div className="glass" style={{padding: 24}}>
        <div style={{fontSize:13,fontWeight:900,color:'#94a3b8',marginBottom:16,letterSpacing:'.1em',textTransform:'uppercase'}}>⚙ Info Hari: <span style={{color: '#fff'}}>{activeDay}</span></div>
        <div style={{display:'grid',gridTemplateColumns:window.innerWidth<600?'1fr':'1fr 1fr 1fr',gap:16}}>
          <div>
            <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Tipe Sesi</label>
            <input value={dayData.type||''} onChange={e=>saveDayMeta('type',e.target.value)} className="inp" style={{fontSize:15, background: 'rgba(0,0,0,0.4)'}} placeholder="Misal: Push Day (Gym)"/>
          </div>
          <div>
            <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Fokus</label>
            <input value={dayData.focus||''} onChange={e=>saveDayMeta('focus',e.target.value)} className="inp" style={{fontSize:15, background: 'rgba(0,0,0,0.4)'}} placeholder="Misal: Dada, Bahu"/>
          </div>
          <div>
            <label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Warna Identitas</label>
            <div style={{display:'flex',gap:8,flexWrap:'wrap',marginTop:4}}>
              {COLOR_PRESETS.map(c=>(
                <div key={c} onClick={()=>saveDayMeta('col',c)} className={`col-swatch ${dayData.col===c?'selected':''}`} style={{width:28,height:28,background:c,borderRadius:8}}/>
              ))}
            </div>
          </div>
        </div>
      </div>

      <div style={{display:'grid',gridTemplateColumns:window.innerWidth<700?'1fr':'1.2fr 1fr',gap:20}}>
        <C style={{gap:10}}>
          <R style={{justifyContent:'space-between',marginBottom:4}}>
            <span style={{fontSize:15,fontWeight:900,color:'#a5b4fc',letterSpacing:'.08em',textTransform:'uppercase'}}>⚡ Latihan Inti ({primaryExes.length})</span>
            <button onClick={()=>setEditExercise({isNew:true,dayKey:activeDay,name:'',detail:'',target:'',category:'primary'})} style={{padding:'8px 14px',background:'rgba(99,102,241,.15)',border:'1px solid rgba(99,102,241,.3)',borderRadius:10,color:'#a5b4fc',fontSize:13,fontWeight:800,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:'Space Grotesk,sans-serif'}}>
              <Icon name="plus" size={14}/>Tambah
            </button>
          </R>
          {exercises.map((ex,i)=>{
            if(ex.category!=='primary')return null;
            return(
              <div key={i} style={{padding:'14px 16px',borderRadius:14,background:'rgba(0,0,0,.4)',border:'1px solid rgba(99,102,241,.3)',borderLeft:'4px solid #6366f1',display:'flex',alignItems:'center',gap:12}}>
                <div style={{flex:1}}>
                  <div style={{fontSize:16,fontWeight:800,color:'#f8fafc'}}>{ex.name}</div>
                  <div style={{fontSize:13,color:'#94a3b8', fontWeight: 600}}>{ex.detail} · {ex.target}</div>
                </div>
                <div style={{display:'flex',gap:4}}>
                  {i>0&&<button onClick={()=>moveExercise(i,i-1)} className="icon-btn"><Icon name="chevron-up" size={14}/></button>}
                  {i<exercises.length-1&&<button onClick={()=>moveExercise(i,i+1)} className="icon-btn"><Icon name="chevron-down" size={14}/></button>}
                  <button onClick={()=>setEditExercise({isNew:false,index:i,...ex})} className="icon-btn"><Icon name="pencil" size={14}/></button>
                  <button onClick={()=>deleteExercise(i)} className="icon-btn red"><Icon name="trash-2" size={14}/></button>
                </div>
              </div>
            );
          })}
        </C>

        <C style={{gap:8}}>
          <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:4}}>
            <span style={{fontSize:14,fontWeight:900,color:'#34d399',letterSpacing:'.08em',textTransform:'uppercase'}}>🩻 Scapular ({SCAPULAR_EXERCISES.length})</span>
            <span style={{fontSize:10,padding:'3px 8px',background:'rgba(16,185,129,.15)',border:'1px solid rgba(16,185,129,.3)',borderRadius:6,color:'#6ee7b7',fontWeight:800}}>TERKUNCI</span>
          </div>
          <div style={{padding:'14px',background:'rgba(16,185,129,.05)',border:'1px solid rgba(16,185,129,.2)',borderRadius:14,fontSize:13,color:'#94a3b8', fontWeight: 600}}>
            Daftar ini ditambahkan otomatis ke semua hari.
          </div>
          {SCAPULAR_EXERCISES.map((ex,i)=>(
            <div key={i} style={{padding:'12px 14px',borderRadius:12,background:'rgba(0,0,0,.2)',border:'1px solid rgba(16,185,129,.2)',borderLeft:'3px solid #10b981',display:'flex',alignItems:'center',gap:12}}>
              <span style={{width:24,height:24,borderRadius:6,background:'rgba(16,185,129,.15)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,fontWeight:800,color:'#34d399',flexShrink:0}}>{i+1}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:14,fontWeight:800,color:'#cbd5e1'}}>{ex.name}</div>
              </div>
            </div>
          ))}
        </C>
      </div>

      {editExercise&&(
        <Modal isOpen={!!editExercise} onClose={()=>setEditExercise(null)} title={`${editExercise.isNew?'Tambah':'Edit'} Gerakan`}>
          <ExerciseForm initial={editExercise} onSave={saveExercise} onCancel={()=>setEditExercise(null)}/>
        </Modal>
      )}
    </C>
  );
};

const ExerciseForm=({initial,onSave,onCancel})=>{
  const[name,setName]=useState(initial.name||'');
  const[detail,setDetail]=useState(initial.detail||'');
  const[target,setTarget]=useState(initial.target||'');
  const submit=(e)=>{e.preventDefault();onSave({...initial,name,detail,target,category:'primary'});};
  return(
    <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:16}}>
      <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Nama Gerakan</label><input value={name} onChange={e=>setName(e.target.value)} className="inp" required placeholder="Misal: Bench Press" style={{background: 'rgba(0,0,0,0.4)'}}/></div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
        <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Set & Rep</label><input value={detail} onChange={e=>setDetail(e.target.value)} className="inp" required placeholder="3 x 10-12" style={{background: 'rgba(0,0,0,0.4)'}}/></div>
        <div><label style={{fontSize:12,fontWeight:800,color:'#94a3b8',letterSpacing:'.08em',display:'block',marginBottom:6,textTransform:'uppercase'}}>Target Otot</label><input value={target} onChange={e=>setTarget(e.target.value)} className="inp" required placeholder="Dada Atas" style={{background: 'rgba(0,0,0,0.4)'}}/></div>
      </div>
      <div style={{display:'flex',gap:12,marginTop:8}}>
        <button type="button" onClick={onCancel} style={{flex:1,padding:'12px',borderRadius:12,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.15)',color:'#cbd5e1',fontWeight:800,cursor:'pointer',fontSize:15,fontFamily:'Space Grotesk,sans-serif'}}>Batal</button>
        <button type="submit" className="btn btn-sm" style={{flex:2, padding: '12px', fontSize: 15}}>Simpan Gerakan</button>
      </div>
    </form>
  );
};

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
</script>
</body>
</html>
